---
title: 'Ordinal regression in R: part 1'
author: Taylor Dunn
date: '2020-03-15'
slug: ordinal-regression-in-r-part-1
categories: []
tags:
  - tidyverse
  - rstats
  - regression
  - frequentist
bibliography: references.bib
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p>The purpose of this post is to learn about ordinal regression models (a.k.a. cumulative link, proportional odds, ordered logit models, etc.) and practice their implementation.
This is part 1, where I’ll be taking the frequentist approach via the <a href="https://cran.r-project.org/web/packages/ordinal/index.html"><code>ordinal</code> package</a>.
There are other options, like <code>MASS::polr</code>, but two features in particular drew me to <code>ordinal</code>: (1) it allows for random effects, and (2) it has <a href="https://rdrr.io/cran/broom/man/ordinal_tidiers.html"><code>broom::tidy</code> methods</a> available.</p>
<p>Particularly, I’ll be following along with</p>
<ul>
<li>this excellent <a href="https://r-forge.r-project.org/scm/viewvc.php/*checkout*/pkg/ordinal/inst/doc/primer.pdf?revision=66&amp;root=ordinal&amp;pathrev=69">primer</a> which includes theory and application, and</li>
<li>this <a href="https://cran.r-project.org/web/packages/ordinal/vignettes/clmm2_tutorial.pdf">vignette</a> which is a tutorial on incorporating random effects.</li>
</ul>
<div id="setup" class="section level1">
<h1>Setup</h1>
<p>Import the usual suspects and set the <code>ggplot2</code> theme:</p>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## Warning: package &#39;tidyverse&#39; was built under R version 3.6.3</code></pre>
<pre><code>## -- Attaching packages ------------------------------------------------------------ tidyverse 1.3.0 --</code></pre>
<pre><code>## v ggplot2 3.3.0           v purrr   0.3.3      
## v tibble  2.1.3           v dplyr   0.8.99.9000
## v tidyr   1.0.2           v stringr 1.4.0      
## v readr   1.3.1           v forcats 0.4.0</code></pre>
<pre><code>## -- Conflicts --------------------------------------------------------------- tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(gt)
library(broom)
library(patchwork)
library(here)</code></pre>
<pre><code>## here() starts at D:/Taylor/Documents/tdunn</code></pre>
<pre class="r"><code># Set ggplot2 theme and defaults
theme_set(cowplot::theme_cowplot() + cowplot::background_grid(major = &quot;xy&quot;))
ggp &lt;- function(...) ggplot(...) +
  scale_color_brewer(palette = &quot;Set1&quot;) +
  scale_fill_brewer(palette = &quot;Set1&quot;)</code></pre>
<p>Import <code>ordinal</code>, and the included data set <code>wine</code>:</p>
<pre class="r"><code>library(ordinal)</code></pre>
<pre><code>## Warning: package &#39;ordinal&#39; was built under R version 3.6.3</code></pre>
<pre><code>## 
## Attaching package: &#39;ordinal&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     slice</code></pre>
<pre class="r"><code>data(wine)
wine &lt;- as_tibble(wine)
glimpse(wine)</code></pre>
<pre><code>## Observations: 72
## Variables: 6
## $ response &lt;dbl&gt; 36, 48, 47, 67, 77, 60, 83, 90, 17, 22, 14, 50, 30, 51, 90...
## $ rating   &lt;ord&gt; 2, 3, 3, 4, 4, 4, 5, 5, 1, 2, 1, 3, 2, 3, 5, 4, 2, 3, 3, 2...
## $ temp     &lt;fct&gt; cold, cold, cold, cold, warm, warm, warm, warm, cold, cold...
## $ contact  &lt;fct&gt; no, no, yes, yes, no, no, yes, yes, no, no, yes, yes, no, ...
## $ bottle   &lt;fct&gt; 1, 2, 3, 4, 5, 6, 7, 8, 1, 2, 3, 4, 5, 6, 7, 8, 1, 2, 3, 4...
## $ judge    &lt;fct&gt; 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3...</code></pre>
<p><code>wine</code> is a data set from <span class="citation">Randall (1989)</span> of wine bitterness ratings from multiple judges.
The variables are as follows:</p>
<ul>
<li>Outcome:
<ul>
<li><code>response</code>: wine bitterness rating on a 0-100 scale</li>
<li><code>rating</code>: ordered factor with 5 levels (grouped version of <code>response</code>) with 1 = “least bitter” and 5 = “most bitter”</li>
</ul></li>
<li>Treatment factors:
<ul>
<li><code>temp</code>: temperature during wine production (cold and warm)</li>
<li><code>contact</code>: contact between juice and skins during wine production (no and yes)</li>
</ul></li>
<li>Random effects
<ul>
<li><code>bottle</code> with 8 levels</li>
<li><code>judge</code> with 9 levels</li>
</ul></li>
</ul>
<p>Relationship between <code>response</code> and <code>rating</code>:</p>
<pre class="r"><code>wine %&gt;%
  ggp(aes(x = rating, y = response)) +
  geom_boxplot() +
  geom_jitter()</code></pre>
<p><img src="/post/2020-03-15-ordinal-regression-in-r-part-1/index_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>Note that there is no overlap between the levels.</p>
<p>There are 72 total observations with the following ratings distribution by treatment and random effects:</p>
<pre class="r"><code>wine %&gt;%
  select(temp, contact, bottle, judge, rating) %&gt;%
  spread(judge, rating) %&gt;%
  gt() %&gt;%
  tab_spanner(columns = vars(`1`, `2`, `3`, `4`, `5`, `6`, `7`, `8`, `9`),
              label = &quot;judge&quot;)</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#wmoazwlmnn .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
}

#wmoazwlmnn .gt_heading {
  background-color: #FFFFFF;
  border-bottom-color: #FFFFFF;
  border-left-style: hidden;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: hidden;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wmoazwlmnn .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wmoazwlmnn .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wmoazwlmnn .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wmoazwlmnn .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wmoazwlmnn .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wmoazwlmnn .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wmoazwlmnn .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wmoazwlmnn .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wmoazwlmnn .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wmoazwlmnn .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#wmoazwlmnn .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wmoazwlmnn .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wmoazwlmnn .gt_from_md > :first-child {
  margin-top: 0;
}

#wmoazwlmnn .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wmoazwlmnn .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wmoazwlmnn .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#wmoazwlmnn .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wmoazwlmnn .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#wmoazwlmnn .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wmoazwlmnn .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wmoazwlmnn .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wmoazwlmnn .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wmoazwlmnn .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#wmoazwlmnn .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wmoazwlmnn .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#wmoazwlmnn .gt_left {
  text-align: left;
}

#wmoazwlmnn .gt_center {
  text-align: center;
}

#wmoazwlmnn .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wmoazwlmnn .gt_font_normal {
  font-weight: normal;
}

#wmoazwlmnn .gt_font_bold {
  font-weight: bold;
}

#wmoazwlmnn .gt_font_italic {
  font-style: italic;
}

#wmoazwlmnn .gt_super {
  font-size: 65%;
}

#wmoazwlmnn .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="wmoazwlmnn" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_center gt_columns_bottom_border" rowspan="2" colspan="1">temp</th>
      <th class="gt_col_heading gt_center gt_columns_bottom_border" rowspan="2" colspan="1">contact</th>
      <th class="gt_col_heading gt_center gt_columns_bottom_border" rowspan="2" colspan="1">bottle</th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="9">
        <span class="gt_column_spanner">judge</span>
      </th>
    </tr>
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">1</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">2</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">3</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">4</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">5</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">6</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">7</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">8</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">9</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_center">cold</td>
      <td class="gt_row gt_center">no</td>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">2</td>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">2</td>
      <td class="gt_row gt_center">3</td>
      <td class="gt_row gt_center">2</td>
      <td class="gt_row gt_center">3</td>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">2</td>
      <td class="gt_row gt_center">1</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">cold</td>
      <td class="gt_row gt_center gt_striped">no</td>
      <td class="gt_row gt_center gt_striped">2</td>
      <td class="gt_row gt_center gt_striped">3</td>
      <td class="gt_row gt_center gt_striped">2</td>
      <td class="gt_row gt_center gt_striped">3</td>
      <td class="gt_row gt_center gt_striped">2</td>
      <td class="gt_row gt_center gt_striped">3</td>
      <td class="gt_row gt_center gt_striped">2</td>
      <td class="gt_row gt_center gt_striped">1</td>
      <td class="gt_row gt_center gt_striped">2</td>
      <td class="gt_row gt_center gt_striped">2</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">cold</td>
      <td class="gt_row gt_center">yes</td>
      <td class="gt_row gt_center">3</td>
      <td class="gt_row gt_center">3</td>
      <td class="gt_row gt_center">1</td>
      <td class="gt_row gt_center">3</td>
      <td class="gt_row gt_center">3</td>
      <td class="gt_row gt_center">4</td>
      <td class="gt_row gt_center">3</td>
      <td class="gt_row gt_center">2</td>
      <td class="gt_row gt_center">2</td>
      <td class="gt_row gt_center">3</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">cold</td>
      <td class="gt_row gt_center gt_striped">yes</td>
      <td class="gt_row gt_center gt_striped">4</td>
      <td class="gt_row gt_center gt_striped">4</td>
      <td class="gt_row gt_center gt_striped">3</td>
      <td class="gt_row gt_center gt_striped">2</td>
      <td class="gt_row gt_center gt_striped">2</td>
      <td class="gt_row gt_center gt_striped">3</td>
      <td class="gt_row gt_center gt_striped">2</td>
      <td class="gt_row gt_center gt_striped">2</td>
      <td class="gt_row gt_center gt_striped">3</td>
      <td class="gt_row gt_center gt_striped">2</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">warm</td>
      <td class="gt_row gt_center">no</td>
      <td class="gt_row gt_center">5</td>
      <td class="gt_row gt_center">4</td>
      <td class="gt_row gt_center">2</td>
      <td class="gt_row gt_center">5</td>
      <td class="gt_row gt_center">3</td>
      <td class="gt_row gt_center">3</td>
      <td class="gt_row gt_center">2</td>
      <td class="gt_row gt_center">2</td>
      <td class="gt_row gt_center">3</td>
      <td class="gt_row gt_center">3</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">warm</td>
      <td class="gt_row gt_center gt_striped">no</td>
      <td class="gt_row gt_center gt_striped">6</td>
      <td class="gt_row gt_center gt_striped">4</td>
      <td class="gt_row gt_center gt_striped">3</td>
      <td class="gt_row gt_center gt_striped">5</td>
      <td class="gt_row gt_center gt_striped">2</td>
      <td class="gt_row gt_center gt_striped">3</td>
      <td class="gt_row gt_center gt_striped">4</td>
      <td class="gt_row gt_center gt_striped">3</td>
      <td class="gt_row gt_center gt_striped">3</td>
      <td class="gt_row gt_center gt_striped">2</td>
    </tr>
    <tr>
      <td class="gt_row gt_center">warm</td>
      <td class="gt_row gt_center">yes</td>
      <td class="gt_row gt_center">7</td>
      <td class="gt_row gt_center">5</td>
      <td class="gt_row gt_center">5</td>
      <td class="gt_row gt_center">4</td>
      <td class="gt_row gt_center">5</td>
      <td class="gt_row gt_center">3</td>
      <td class="gt_row gt_center">5</td>
      <td class="gt_row gt_center">2</td>
      <td class="gt_row gt_center">3</td>
      <td class="gt_row gt_center">4</td>
    </tr>
    <tr>
      <td class="gt_row gt_center gt_striped">warm</td>
      <td class="gt_row gt_center gt_striped">yes</td>
      <td class="gt_row gt_center gt_striped">8</td>
      <td class="gt_row gt_center gt_striped">5</td>
      <td class="gt_row gt_center gt_striped">4</td>
      <td class="gt_row gt_center gt_striped">4</td>
      <td class="gt_row gt_center gt_striped">3</td>
      <td class="gt_row gt_center gt_striped">3</td>
      <td class="gt_row gt_center gt_striped">4</td>
      <td class="gt_row gt_center gt_striped">3</td>
      <td class="gt_row gt_center gt_striped">4</td>
      <td class="gt_row gt_center gt_striped">4</td>
    </tr>
  </tbody>
  
  
</table></div>
<p>So each <code>bottle</code> had a particular <code>temp</code> and <code>contact</code> (2 bottles for each of the 4 combinations), and each <code>judge</code> rated each bottle.</p>
<p>Before modeling, can we see a clear effect of <code>temp</code> and <code>contact</code>?</p>
<pre class="r"><code>wine %&gt;%
  count(contact, rating, temp) %&gt;%
  mutate(temp = fct_rev(temp)) %&gt;%
  ggp(aes(x = contact, y = rating, color = temp)) +
  geom_point(aes(group = temp, size = n), position = position_dodge(1)) +
  cowplot::theme_minimal_hgrid() +
  facet_wrap(~contact, scales = &quot;free_x&quot;) +
  theme(
    strip.background = element_blank(),
    strip.text.x = element_blank()
  ) +
  scale_size(breaks = c(1, 2, 4, 6, 8))</code></pre>
<p><img src="/post/2020-03-15-ordinal-regression-in-r-part-1/index_files/figure-html/unnamed-chunk-5-1.png" width="384" /></p>
<p>At a glance, it looks like the <code>temp</code> = warm and <code>contact</code> = yes is associated with higher <code>rating</code>s.</p>
</div>
<div id="the-cumulative-link-model" class="section level1">
<h1>The cumulative link model</h1>
<div id="theory" class="section level2">
<h2>Theory</h2>
<p>The ordinal response <span class="math inline">\(y_i\)</span> falls into response category <span class="math inline">\(j\)</span> (out of <span class="math inline">\(J\)</span> total) with probability <span class="math inline">\(\pi_{ij}\)</span>.
The cumulative probabilities are defined:</p>
<p><span class="math display">\[
P(y_i \leq j) = \pi_{i1} + \dots + \pi_{ij}.
\]</span></p>
<p>As an oversimplification, suppose that each probability <span class="math inline">\(\pi_{ij}\)</span> is equal to the proportion of that response in the <code>wine</code> data.
Then the cumulative “probability” can be visualized:</p>
<pre class="r"><code>wine_prop &lt;- wine %&gt;%
  count(rating) %&gt;%
  mutate(p = n / sum(n),
         cumsum_p = cumsum(p))
(
ggp(wine_prop, aes(x = rating, y = p)) +
  geom_col() +
  scale_y_continuous(labels = scales::percent, expand = c(0, 0)) +
  labs(x = &quot;j&quot;, y = &quot;proportion&quot;) +
  cowplot::theme_minimal_hgrid()
) +
  (
    ggp(wine_prop, aes(x = as.integer(rating), y = cumsum_p)) +
      geom_point() +
      geom_line() +
      labs(x = &quot;j&quot;, y = &quot;cumulative proportion&quot;) +
      cowplot::theme_minimal_hgrid()
  ) +
  (
    ggp(wine_prop,
        aes(x = as.integer(rating), y = log(cumsum_p) - log(1 - cumsum_p))) +
      geom_point() +
      geom_line() +
      labs(x = &quot;j&quot;, y = &quot;logit(cumulative proportion)&quot;) +
      cowplot::theme_minimal_hgrid()
  )</code></pre>
<p><img src="/post/2020-03-15-ordinal-regression-in-r-part-1/index_files/figure-html/unnamed-chunk-6-1.png" width="960" /></p>
<p>We will explore other links, but first the most common, the logit link, which is depicted in the right-most panel of the above figure:</p>
<p><span class="math display">\[
\text{logit} (P(y_i \leq j) = \log \frac{P(y_i \leq j)}{1 - P(y_i \leq j)}
\]</span></p>
<p>Note that the above function is defined for all but the last category <span class="math inline">\(j = J\)</span>, because <span class="math inline">\(1 - P(Y_i \leq J) = 1 - 1 = 0\)</span>.</p>
<p>For the <code>wine</code> data, where we have <span class="math inline">\(J\)</span> = 5 rating categories, we will build up to the following mixed effects model:</p>
<p><span class="math display">\[
\begin{align}
\text{logit}(p(y_i \leq j)) &amp;= \theta_j - \beta_1 \text{temp}_i - \beta_2 \text{contact}_i - u( \text{judge}_i) \\
i &amp;= 1, \dots n \; \; \; \; \; \; j = 1, \dots, J - 1
\end{align}
\]</span></p>
<p>where <span class="math inline">\(\theta_j\)</span> is called the threshold parameter, or cutpoint, of category <span class="math inline">\(j\)</span>.
These thresholds can also be thought of as <span class="math inline">\(J-1\)</span> = 4 intercepts.
Note that the fixed effect parameters <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span> are independent of <span class="math inline">\(j\)</span>, so each <span class="math inline">\(\beta\)</span> has the same effect for each of the <span class="math inline">\(J-1\)</span> cumulative logits.
The judge effects, which are also independent of <span class="math inline">\(j\)</span>, are assumed normal: <span class="math inline">\(u(\text{judge}_i) \sim N(0, \sigma_u^2)\)</span>.
We are using the logit link because it is the most popular for this kind of model (and the one I am familiar with), but there are other options we will briefly explore later.</p>
<p>The subtraction of terms in the above model is new to me.
The main reason seems to be for familiar interpretation: the larger the value of any independent term <span class="math inline">\(\beta x\)</span>, the smaller the thresholds <span class="math inline">\(\theta_j\)</span>, and therefore a larger probability of the a response falling into a category at the upper end of the scale.
This way, <span class="math inline">\(\beta\)</span> has the same <em>direction</em> of effect as in ordinary linear regression.</p>
<p>We are essentially modeling a “chain” of logistic regressions where the binary response is “less than or equal to a certain level” vs “greater than that level”.
In this case, with <span class="math inline">\(J\)</span> = 5, the thresholds <span class="math inline">\(\theta_j\)</span> are capturing the adjusted log-odds of observing:</p>
<ul>
<li><span class="math inline">\(j\)</span> = 1: log-odds of <code>rating</code> = 1 vs. 2-5</li>
<li><span class="math inline">\(j\)</span> = 2: log-odds of <code>rating</code> = 1-2 vs. 3-5</li>
<li><span class="math inline">\(j\)</span> = 3: log-odds of <code>rating</code> = 1-3 vs. 4-5</li>
<li><span class="math inline">\(j\)</span> = 4: log-odds of <code>rating</code> = 1-4 vs. 5</li>
</ul>
</div>
<div id="fitting" class="section level2">
<h2>Fitting</h2>
<p>Now with a surface-level understanding of what is being modeled, we will fit the data using <code>ordinal::clm</code> (cumulative link models) and <code>ordinal::clmm</code> (cumulative link mixed models), and logit links.</p>
<div id="fixed-effects-model" class="section level3">
<h3>Fixed effects model</h3>
<p>First, fit a simple model, by maximum likelihood, with <code>contact</code> as the sole predictor:</p>
<p><span class="math display">\[
\text{logit}(p(y_i \leq j)) = \theta_j - \beta_2 \text{contact}_i
\]</span></p>
<pre class="r"><code>clm_rating_contact &lt;-
  clm(
    rating ~ contact,
    data = wine, link = &quot;logit&quot;
  )
summary(clm_rating_contact)</code></pre>
<pre><code>## formula: rating ~ contact
## data:    wine
## 
##  link  threshold nobs logLik AIC    niter max.grad cond.H 
##  logit flexible  72   -99.96 209.91 5(0)  1.67e-07 1.7e+01
## 
## Coefficients:
##            Estimate Std. Error z value Pr(&gt;|z|)   
## contactyes   1.2070     0.4499   2.683   0.0073 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Threshold coefficients:
##     Estimate Std. Error z value
## 1|2 -2.13933    0.48981  -4.368
## 2|3  0.04257    0.32063   0.133
## 3|4  1.71449    0.38637   4.437
## 4|5  2.97875    0.50207   5.933</code></pre>
<p>The model gives us <span class="math inline">\(K - 1 = 4\)</span> threshold coefficients, as expected.
The <span class="math inline">\(\beta_2\)</span> coefficient estimate was statistically significant (by a Wald test), and tells us that <code>contact</code> = yes <em>decreases</em> the thresholds <span class="math inline">\(\theta_j\)</span> by <span class="math inline">\(\beta_2\)</span> = 1.21 (because of the subtraction of model terms), and therefore is associated with <em>higher</em> <code>rating</code>s.</p>
<p>The condition number of the Hessian for this model is 16.98.
The primer says that larger values (like &gt; <code>1e4</code>) might indicate that the model is ill-defined.</p>
<p>It is nicely illustrative to compare this model to 4 separate logistic regressions with a dichotomized response:</p>
<p><span class="math display">\[
\begin{align}
\text{logit} (p(y_i \leq 1)) = \theta_1 + \beta_2 \text{contact_i} \\
\text{logit} (p(y_i \leq 2)) = \theta_2 + \beta_2 \text{contact_i} \\
\text{logit} (p(y_i \leq 3)) = \theta_3 + \beta_2 \text{contact_i} \\
\text{logit} (p(y_i \leq 4)) = \theta_4 + \beta_2 \text{contact_i} \\
\end{align}
\]</span></p>
<pre class="r"><code>wine %&gt;%
  crossing(j = 1:4) %&gt;%
  # Create a binary (0 or 1) to indicate where rating &lt;= j
  mutate(rating_leq_j = as.numeric(rating) &lt;= j) %&gt;%
  group_by(j) %&gt;%
  nest() %&gt;%
  ungroup() %&gt;%
  mutate(
    mod = map(
      data,
      ~glm(rating_leq_j ~ 1 + contact,
           data = ., family = binomial(link = &quot;logit&quot;))
    ),
    mod_tidy = map(mod, tidy)
  ) %&gt;%
  unnest(mod_tidy) %&gt;%
  transmute(
    j, term,
    estimate_se = str_c(round(estimate, 2), &quot; (&quot;, round(std.error, 2), &quot;)&quot;)
  ) %&gt;%
  spread(term, estimate_se) %&gt;%
  left_join(
    tidy(clm_rating_contact) %&gt;%
      transmute(
        j = as.integer(substr(term, 1, 1)),
        term = if_else(!is.na(j), &quot;theta_j&quot;, term),
        estimate_se = str_c(round(estimate, 2), &quot; (&quot;, round(std.error, 2), &quot;)&quot;)
      ) %&gt;%
      mutate(j = replace_na(j, 1)) %&gt;%
      spread(term, estimate_se),
    by = &quot;j&quot;
  ) %&gt;%
  ungroup() %&gt;%
  gt() %&gt;%
  tab_spanner(label = &quot;Logistic regression&quot;,
              columns = vars(`(Intercept)`, contactyes.x)) %&gt;%
  tab_spanner(label = &quot;CLM&quot;,
              columns = vars(theta_j, contactyes.y)) %&gt;%
  fmt_missing(columns = everything(), missing_text = &quot;&quot;)</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#trlibdluvh .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
}

#trlibdluvh .gt_heading {
  background-color: #FFFFFF;
  border-bottom-color: #FFFFFF;
  border-left-style: hidden;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: hidden;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#trlibdluvh .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#trlibdluvh .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#trlibdluvh .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#trlibdluvh .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#trlibdluvh .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#trlibdluvh .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#trlibdluvh .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#trlibdluvh .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#trlibdluvh .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#trlibdluvh .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#trlibdluvh .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#trlibdluvh .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#trlibdluvh .gt_from_md > :first-child {
  margin-top: 0;
}

#trlibdluvh .gt_from_md > :last-child {
  margin-bottom: 0;
}

#trlibdluvh .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#trlibdluvh .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#trlibdluvh .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#trlibdluvh .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#trlibdluvh .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#trlibdluvh .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#trlibdluvh .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#trlibdluvh .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#trlibdluvh .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#trlibdluvh .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#trlibdluvh .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#trlibdluvh .gt_left {
  text-align: left;
}

#trlibdluvh .gt_center {
  text-align: center;
}

#trlibdluvh .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#trlibdluvh .gt_font_normal {
  font-weight: normal;
}

#trlibdluvh .gt_font_bold {
  font-weight: bold;
}

#trlibdluvh .gt_font_italic {
  font-style: italic;
}

#trlibdluvh .gt_super {
  font-size: 65%;
}

#trlibdluvh .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="trlibdluvh" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_center gt_columns_bottom_border" rowspan="2" colspan="1">j</th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="2">
        <span class="gt_column_spanner">Logistic regression</span>
      </th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="2">
        <span class="gt_column_spanner">CLM</span>
      </th>
    </tr>
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">(Intercept)</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">contactyes.x</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">theta_j</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">contactyes.y</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_right">1</td>
      <td class="gt_row gt_left">-2.08 (0.53)</td>
      <td class="gt_row gt_left">-1.48 (1.14)</td>
      <td class="gt_row gt_left">-2.14 (0.49)</td>
      <td class="gt_row gt_left">1.21 (0.45)</td>
    </tr>
    <tr>
      <td class="gt_row gt_right gt_striped">2</td>
      <td class="gt_row gt_left gt_striped">0 (0.33)</td>
      <td class="gt_row gt_left gt_striped">-1.1 (0.51)</td>
      <td class="gt_row gt_left gt_striped">0.04 (0.32)</td>
      <td class="gt_row gt_left gt_striped"></td>
    </tr>
    <tr>
      <td class="gt_row gt_right">3</td>
      <td class="gt_row gt_left">1.82 (0.48)</td>
      <td class="gt_row gt_left">-1.37 (0.59)</td>
      <td class="gt_row gt_left">1.71 (0.39)</td>
      <td class="gt_row gt_left"></td>
    </tr>
    <tr>
      <td class="gt_row gt_right gt_striped">4</td>
      <td class="gt_row gt_left gt_striped">2.83 (0.73)</td>
      <td class="gt_row gt_left gt_striped">-1.01 (0.87)</td>
      <td class="gt_row gt_left gt_striped">2.98 (0.5)</td>
      <td class="gt_row gt_left gt_striped"></td>
    </tr>
  </tbody>
  
  
</table></div>
<p>The intercepts from the ordinary logistic regression correspond closely to the threshold parameters <span class="math inline">\(\theta_j\)</span> from the cumulative link model.
In the fixed effect of <code>contact</code> (<span class="math inline">\(\beta_2\)</span>), first note the sign difference, and second notice that the estimate from CLM is about the average of the 4 estimates from logistic regression.
The advantage of the CLM is seen in the small standard error in the <span class="math inline">\(\beta_2\)</span> estimate.</p>
<p>To quote the primer:</p>
<blockquote>
<p>The cumulative logit model can be seen as the model that combines these four ordinary logistic regression models into a single model and therefore makes better use of the information in the data.</p>
</blockquote>
<p>For the second model, we add the <span class="math inline">\(\beta_1 \text{temp}_i\)</span> term:</p>
<p><span class="math display">\[
\text{logit}(p(y_i \leq j)) = \theta_j - \beta_1 \text{temp}_i - \beta_2 \text{contact}_i
\]</span></p>
<pre class="r"><code>clm_rating_contact_temp &lt;-
  clm(
    rating ~ contact + temp,
    data = wine, link = &quot;logit&quot;
  )
summary(clm_rating_contact_temp)</code></pre>
<pre><code>## formula: rating ~ contact + temp
## data:    wine
## 
##  link  threshold nobs logLik AIC    niter max.grad cond.H 
##  logit flexible  72   -86.49 184.98 6(0)  4.01e-12 2.7e+01
## 
## Coefficients:
##            Estimate Std. Error z value Pr(&gt;|z|)    
## contactyes   1.5278     0.4766   3.205  0.00135 ** 
## tempwarm     2.5031     0.5287   4.735 2.19e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Threshold coefficients:
##     Estimate Std. Error z value
## 1|2  -1.3444     0.5171  -2.600
## 2|3   1.2508     0.4379   2.857
## 3|4   3.4669     0.5978   5.800
## 4|5   5.0064     0.7309   6.850</code></pre>
<p>Both fixed effects (<code>contact</code> = yes and <code>temp</code> = warm) are strongly associated with higher probability of higher ratings.
The <code>summary</code> function provides p values from Wald tests, but more accurate likelihood ratio tests can be done via the <code>drop1</code> function, which evaluates each fixed effect while controlling the other:</p>
<pre class="r"><code>drop1(clm_rating_contact_temp, test = &quot;Chisq&quot;)</code></pre>
<pre><code>## Single term deletions
## 
## Model:
## rating ~ contact + temp
##         Df    AIC    LRT  Pr(&gt;Chi)    
## &lt;none&gt;     184.98                     
## contact  1 194.03 11.043 0.0008902 ***
## temp     1 209.91 26.928 2.112e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Or the reverse via the <code>add1()</code> function, which evaluates each fixed effect while ignoring the other:</p>
<pre class="r"><code># Fit the null model first
clm_rating_null &lt;-
  clm(
    rating ~ 1,
    data = wine, link = &quot;logit&quot;
  )
add1(clm_rating_null, scope = ~ contact + temp, test = &quot;Chisq&quot;)</code></pre>
<pre><code>## Single term additions
## 
## Model:
## rating ~ 1
##         Df    AIC     LRT  Pr(&gt;Chi)    
## &lt;none&gt;     215.44                      
## contact  1 209.91  7.5263   0.00608 ** 
## temp     1 194.03 23.4113 1.308e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Symmetric Wald confidence intervals can be extracted with <code>confint</code> or with <code>broom::tidy</code>:</p>
<pre class="r"><code>tidy(clm_rating_contact_temp, conf.int = T, conf.type = &quot;Wald&quot;) %&gt;%
  ggp(aes(y = term, x = estimate)) +
  geom_point() +
  geom_linerange(aes(xmin = conf.low, xmax = conf.high))</code></pre>
<p><img src="/post/2020-03-15-ordinal-regression-in-r-part-1/index_files/figure-html/unnamed-chunk-12-1.png" width="480" /></p>
<p>In these types of analyses, we are often interested in the odds ratios.
For the two categorical fixed effects, which have two levels each, the odds ratios <span class="math inline">\(y \leq j\)</span> comparing the two levels are:</p>
<p><span class="math display">\[
\begin{align}
\text{OR} &amp;= \frac{\gamma_j (\text{temp} = \text{warm})}{\gamma_j (\text{temp} = \text{cold})} = \frac{\exp(\theta_j - \beta_1 - \beta_2 \text{contact})}{\exp (\theta_j - 0 - \beta_2 \text{contact}}) = \exp(\beta_1) \\
\text{OR} &amp;= \frac{\gamma_j (\text{contact} = \text{yes})}{\gamma_j (\text{contact} = \text{no})} = \frac{\exp(\theta_j - \beta_1 \text{temp} - \beta_2 )}{\exp (\theta_j - \beta_1 \text{temp} - 0)}) = \exp(\beta_2)
\end{align}
\]</span></p>
<p>where we have introduced the shorthand <span class="math inline">\(\gamma_j = \text{logit} (p(y \leq j))\)</span>.
Compute those odds ratios, and their corresponding Wald 95% CIs:</p>
<pre class="r"><code>tidy(clm_rating_contact_temp, conf.int = T, conf.type = &quot;Wald&quot;) %&gt;%
  transmute(
    term,
    across(c(estimate, conf.low, conf.high), exp)
  ) %&gt;%
  gt() %&gt;%
  fmt_number(vars(estimate, conf.low, conf.high), decimals = 2)</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#oilmsuhewk .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
}

#oilmsuhewk .gt_heading {
  background-color: #FFFFFF;
  border-bottom-color: #FFFFFF;
  border-left-style: hidden;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: hidden;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#oilmsuhewk .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#oilmsuhewk .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#oilmsuhewk .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oilmsuhewk .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#oilmsuhewk .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#oilmsuhewk .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#oilmsuhewk .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#oilmsuhewk .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#oilmsuhewk .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#oilmsuhewk .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#oilmsuhewk .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#oilmsuhewk .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#oilmsuhewk .gt_from_md > :first-child {
  margin-top: 0;
}

#oilmsuhewk .gt_from_md > :last-child {
  margin-bottom: 0;
}

#oilmsuhewk .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#oilmsuhewk .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#oilmsuhewk .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#oilmsuhewk .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#oilmsuhewk .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#oilmsuhewk .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#oilmsuhewk .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oilmsuhewk .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#oilmsuhewk .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#oilmsuhewk .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#oilmsuhewk .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#oilmsuhewk .gt_left {
  text-align: left;
}

#oilmsuhewk .gt_center {
  text-align: center;
}

#oilmsuhewk .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#oilmsuhewk .gt_font_normal {
  font-weight: normal;
}

#oilmsuhewk .gt_font_bold {
  font-weight: bold;
}

#oilmsuhewk .gt_font_italic {
  font-style: italic;
}

#oilmsuhewk .gt_super {
  font-size: 65%;
}

#oilmsuhewk .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="oilmsuhewk" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">term</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">estimate</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.low</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">conf.high</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">1|2</td>
      <td class="gt_row gt_right">0.26</td>
      <td class="gt_row gt_right">0.09</td>
      <td class="gt_row gt_right">0.72</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">2|3</td>
      <td class="gt_row gt_right gt_striped">3.49</td>
      <td class="gt_row gt_right gt_striped">1.48</td>
      <td class="gt_row gt_right gt_striped">8.24</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">3|4</td>
      <td class="gt_row gt_right">32.04</td>
      <td class="gt_row gt_right">9.93</td>
      <td class="gt_row gt_right">103.39</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">4|5</td>
      <td class="gt_row gt_right gt_striped">149.37</td>
      <td class="gt_row gt_right gt_striped">35.65</td>
      <td class="gt_row gt_right gt_striped">625.75</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">contactyes</td>
      <td class="gt_row gt_right">4.61</td>
      <td class="gt_row gt_right">1.81</td>
      <td class="gt_row gt_right">11.73</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">tempwarm</td>
      <td class="gt_row gt_right gt_striped">12.22</td>
      <td class="gt_row gt_right gt_striped">4.34</td>
      <td class="gt_row gt_right gt_striped">34.44</td>
    </tr>
  </tbody>
  
  
</table></div>
<p>One last thing to check: does the model support an interaction between <span class="math inline">\(\text{temp}_i\)</span> and <span class="math inline">\(\text{contact}_i\)</span>?</p>
<p><span class="math display">\[
\text{logit}(p(y_i \leq j)) = \theta_j - \beta_1 \text{temp}_i - \beta_2 \text{contact}_i - \beta_3 \text{temp}_i \text{contact}_i
\]</span></p>
<pre class="r"><code>clm_rating_contact_temp_inter &lt;-
  clm(
    rating ~ contact * temp,
    data = wine, link = &quot;logit&quot;
  )
#drop1(clm_rating_contact_temp_inter, test = &quot;Chisq&quot;) # this accomplishes the same thing as anova()
anova(clm_rating_contact_temp, clm_rating_contact_temp_inter)</code></pre>
<pre><code>## Likelihood ratio tests of cumulative link models:
##  
##                               formula:                link: threshold:
## clm_rating_contact_temp       rating ~ contact + temp logit flexible  
## clm_rating_contact_temp_inter rating ~ contact * temp logit flexible  
## 
##                               no.par    AIC  logLik LR.stat df Pr(&gt;Chisq)
## clm_rating_contact_temp            6 184.98 -86.492                      
## clm_rating_contact_temp_inter      7 186.83 -86.416  0.1514  1     0.6972</code></pre>
<p>The interaction term <code>contact:temp</code> is not supported by the data.</p>
<div id="comparison-to-linear-model" class="section level4">
<h4>Comparison to linear model</h4>
<p>Consider the following linear model which treats <code>rating</code> as continuous:</p>
<p><span class="math display">\[
y_i = \alpha + \beta_1 \text{temp}_i + \beta_2 \text{contact}_i + \epsilon_i
\]</span></p>
<p>where <span class="math inline">\(\epsilon_i \sim N(0, \sigma_{\epsilon}^2)\)</span>.</p>
<pre class="r"><code>lm_rating_contact_temp &lt;-
  lm(as.numeric(rating) ~ contact + temp, data = wine)</code></pre>
<p>To compare this to a CLM, we must use the probit link:</p>
<pre class="r"><code>clm_rating_contact_temp_probit &lt;-
  clm(
    rating ~ contact + temp,
    data = wine, link = &quot;probit&quot;
  )

tidy(clm_rating_contact_temp_probit) %&gt;%
  filter(coefficient_type == &quot;beta&quot;) %&gt;%
  mutate(model = &quot;CLM&quot;) %&gt;%
  select(-coefficient_type) %&gt;%
  bind_rows(
    tidy(lm_rating_contact_temp) %&gt;%
      filter(term != &quot;(Intercept)&quot;) %&gt;%
      # Not sure why we need to divide by the residual SE here
      mutate(estimate = estimate / summary(lm_rating_contact_temp)$sigma,
             model = &quot;LM&quot;)
  ) %&gt;%
  group_by(model) %&gt;%
  gt() %&gt;%
  fmt_number(vars(estimate, std.error, statistic), decimals = 2) %&gt;%
  fmt(vars(p.value), fns = scales::pvalue)</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#yjilimfoqj .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
}

#yjilimfoqj .gt_heading {
  background-color: #FFFFFF;
  border-bottom-color: #FFFFFF;
  border-left-style: hidden;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: hidden;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yjilimfoqj .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#yjilimfoqj .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#yjilimfoqj .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yjilimfoqj .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yjilimfoqj .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#yjilimfoqj .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#yjilimfoqj .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#yjilimfoqj .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#yjilimfoqj .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#yjilimfoqj .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#yjilimfoqj .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#yjilimfoqj .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#yjilimfoqj .gt_from_md > :first-child {
  margin-top: 0;
}

#yjilimfoqj .gt_from_md > :last-child {
  margin-bottom: 0;
}

#yjilimfoqj .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#yjilimfoqj .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#yjilimfoqj .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yjilimfoqj .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#yjilimfoqj .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yjilimfoqj .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#yjilimfoqj .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yjilimfoqj .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yjilimfoqj .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#yjilimfoqj .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yjilimfoqj .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#yjilimfoqj .gt_left {
  text-align: left;
}

#yjilimfoqj .gt_center {
  text-align: center;
}

#yjilimfoqj .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#yjilimfoqj .gt_font_normal {
  font-weight: normal;
}

#yjilimfoqj .gt_font_bold {
  font-weight: bold;
}

#yjilimfoqj .gt_font_italic {
  font-style: italic;
}

#yjilimfoqj .gt_super {
  font-size: 65%;
}

#yjilimfoqj .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="yjilimfoqj" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">term</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">estimate</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">std.error</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">statistic</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">p.value</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr class="gt_group_heading_row">
      <td colspan="5" class="gt_group_heading">CLM</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">contactyes</td>
      <td class="gt_row gt_right">0.87</td>
      <td class="gt_row gt_right">0.27</td>
      <td class="gt_row gt_right">3.25</td>
      <td class="gt_row gt_right">0.001</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">tempwarm</td>
      <td class="gt_row gt_right gt_striped">1.50</td>
      <td class="gt_row gt_right gt_striped">0.29</td>
      <td class="gt_row gt_right gt_striped">5.14</td>
      <td class="gt_row gt_right gt_striped"><0.001</td>
    </tr>
    <tr class="gt_group_heading_row">
      <td colspan="5" class="gt_group_heading">LM</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">contactyes</td>
      <td class="gt_row gt_right">0.79</td>
      <td class="gt_row gt_right">0.20</td>
      <td class="gt_row gt_right">3.36</td>
      <td class="gt_row gt_right">0.001</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">tempwarm</td>
      <td class="gt_row gt_right gt_striped">1.38</td>
      <td class="gt_row gt_right gt_striped">0.20</td>
      <td class="gt_row gt_right gt_striped">5.87</td>
      <td class="gt_row gt_right gt_striped"><0.001</td>
    </tr>
  </tbody>
  
  
</table></div>
<p>The relative estimates from the linear model are lower than those from the CLM (probit link), indicating that the assumptions of the linear model are not met.
In particular, the distance between thresholds is not equidistant:</p>
<pre class="r"><code>diff(coef(clm_rating_contact_temp_probit)[1:4]) %&gt;% round(2)</code></pre>
<pre><code>##  2|3  3|4  4|5 
## 1.51 1.31 0.90</code></pre>
</div>
</div>
<div id="mixed-effects-model" class="section level3">
<h3>Mixed effects model</h3>
<p>Now that we have explored ordinal regression with just fixed effects, we will fit the following random effects model:</p>
<p><span class="math display">\[
\begin{align}
\text{logit}(p(y_i \leq j)) &amp;= \theta_j - \beta_1 \text{temp}_i - \beta_2 \text{contact}_i - u( \text{judge}_i) \\
i &amp;= 1, \dots n \; \; \; \; \; \; j = 1, \dots, J - 1
\end{align}
\]</span></p>
<p>where the judge effects are independent of <span class="math inline">\(j\)</span>, and assumed normal: <span class="math inline">\(u(\text{judge}_i) \sim N(0, \sigma_u^2)\)</span>.</p>
<p>Each judge has 8 <code>rating</code>s each (two per combination of <code>temp</code> and <code>contact</code>).
See if we can spot the <code>judge</code> variance in a plot of <code>rating</code>s:</p>
<pre class="r"><code>wine %&gt;%
  count(judge, rating) %&gt;%
  ggplot(aes(x = judge, y = rating)) +
  geom_tile(aes(fill = n)) +
  geom_text(aes(label = n), color = &quot;white&quot;) +
  cowplot::theme_half_open() +
  scale_x_discrete(expand = c(0, 0)) +
  scale_y_discrete(expand = c(0, 0)) +
  theme(legend.position = &quot;none&quot;) +
  scale_fill_viridis_c() +
  labs(title = &quot;Number of ratings by judge&quot;)</code></pre>
<p><img src="/post/2020-03-15-ordinal-regression-in-r-part-1/index_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>There is definitely some judge-specific variability in the perception of bitterness of wine.
<code>judge</code> 5, for instance, doesn’t stray far from <code>rating</code> = 3, while <code>judge</code> 7 didn’t consider any of the wines particularly bitter.</p>
<p>Fit the full model with <code>ordinal::clmm</code> and logit link:</p>
<pre class="r"><code>clmm_rating_contact_temp &lt;-
  clmm(
    rating ~ temp + contact + (1|judge),
    data = wine, link = &quot;logit&quot;
  )
# This is an older function, which we need to run stats::profile later
clmm2_rating_contact_temp &lt;-
  clmm2(
    rating ~ temp + contact, random = judge,
    data = wine, link = &quot;logistic&quot;
  )
summary(clmm_rating_contact_temp)</code></pre>
<pre><code>## Cumulative Link Mixed Model fitted with the Laplace approximation
## 
## formula: rating ~ temp + contact + (1 | judge)
## data:    wine
## 
##  link  threshold nobs logLik AIC    niter    max.grad cond.H 
##  logit flexible  72   -81.57 177.13 332(999) 1.03e-05 2.8e+01
## 
## Random effects:
##  Groups Name        Variance Std.Dev.
##  judge  (Intercept) 1.279    1.131   
## Number of groups:  judge 9 
## 
## Coefficients:
##            Estimate Std. Error z value Pr(&gt;|z|)    
## tempwarm     3.0630     0.5954   5.145 2.68e-07 ***
## contactyes   1.8349     0.5125   3.580 0.000344 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Threshold coefficients:
##     Estimate Std. Error z value
## 1|2  -1.6237     0.6824  -2.379
## 2|3   1.5134     0.6038   2.507
## 3|4   4.2285     0.8090   5.227
## 4|5   6.0888     0.9725   6.261</code></pre>
<p>Compare model coefficients:</p>
<pre class="r"><code>tidy(clm_rating_contact_temp) %&gt;%
  select(-coefficient_type) %&gt;%
  mutate(model = &quot;CLM&quot;) %&gt;%
  bind_rows(
    tidy(clmm_rating_contact_temp) %&gt;%
      select(-coefficient_type) %&gt;%
      mutate(model = &quot;CLMM&quot;)
  ) %&gt;%
  group_by(model) %&gt;%
  gt() %&gt;%
  fmt_number(vars(estimate, std.error, statistic), decimals = 2) %&gt;%
  fmt(vars(p.value), fns = scales::pvalue)</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#splqkyojjv .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
}

#splqkyojjv .gt_heading {
  background-color: #FFFFFF;
  border-bottom-color: #FFFFFF;
  border-left-style: hidden;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: hidden;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#splqkyojjv .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#splqkyojjv .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#splqkyojjv .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#splqkyojjv .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#splqkyojjv .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#splqkyojjv .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#splqkyojjv .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#splqkyojjv .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#splqkyojjv .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#splqkyojjv .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#splqkyojjv .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#splqkyojjv .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#splqkyojjv .gt_from_md > :first-child {
  margin-top: 0;
}

#splqkyojjv .gt_from_md > :last-child {
  margin-bottom: 0;
}

#splqkyojjv .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#splqkyojjv .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#splqkyojjv .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#splqkyojjv .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#splqkyojjv .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#splqkyojjv .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#splqkyojjv .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#splqkyojjv .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#splqkyojjv .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#splqkyojjv .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#splqkyojjv .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#splqkyojjv .gt_left {
  text-align: left;
}

#splqkyojjv .gt_center {
  text-align: center;
}

#splqkyojjv .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#splqkyojjv .gt_font_normal {
  font-weight: normal;
}

#splqkyojjv .gt_font_bold {
  font-weight: bold;
}

#splqkyojjv .gt_font_italic {
  font-style: italic;
}

#splqkyojjv .gt_super {
  font-size: 65%;
}

#splqkyojjv .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="splqkyojjv" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">term</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">estimate</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">std.error</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">statistic</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">p.value</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr class="gt_group_heading_row">
      <td colspan="5" class="gt_group_heading">CLM</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">1|2</td>
      <td class="gt_row gt_right">&minus;1.34</td>
      <td class="gt_row gt_right">0.52</td>
      <td class="gt_row gt_right">&minus;2.60</td>
      <td class="gt_row gt_right">0.009</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">2|3</td>
      <td class="gt_row gt_right gt_striped">1.25</td>
      <td class="gt_row gt_right gt_striped">0.44</td>
      <td class="gt_row gt_right gt_striped">2.86</td>
      <td class="gt_row gt_right gt_striped">0.004</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">3|4</td>
      <td class="gt_row gt_right">3.47</td>
      <td class="gt_row gt_right">0.60</td>
      <td class="gt_row gt_right">5.80</td>
      <td class="gt_row gt_right"><0.001</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">4|5</td>
      <td class="gt_row gt_right gt_striped">5.01</td>
      <td class="gt_row gt_right gt_striped">0.73</td>
      <td class="gt_row gt_right gt_striped">6.85</td>
      <td class="gt_row gt_right gt_striped"><0.001</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">contactyes</td>
      <td class="gt_row gt_right">1.53</td>
      <td class="gt_row gt_right">0.48</td>
      <td class="gt_row gt_right">3.21</td>
      <td class="gt_row gt_right">0.001</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">tempwarm</td>
      <td class="gt_row gt_right gt_striped">2.50</td>
      <td class="gt_row gt_right gt_striped">0.53</td>
      <td class="gt_row gt_right gt_striped">4.73</td>
      <td class="gt_row gt_right gt_striped"><0.001</td>
    </tr>
    <tr class="gt_group_heading_row">
      <td colspan="5" class="gt_group_heading">CLMM</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">1|2</td>
      <td class="gt_row gt_right">&minus;1.62</td>
      <td class="gt_row gt_right">0.68</td>
      <td class="gt_row gt_right">&minus;2.38</td>
      <td class="gt_row gt_right">0.017</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">2|3</td>
      <td class="gt_row gt_right gt_striped">1.51</td>
      <td class="gt_row gt_right gt_striped">0.60</td>
      <td class="gt_row gt_right gt_striped">2.51</td>
      <td class="gt_row gt_right gt_striped">0.012</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">3|4</td>
      <td class="gt_row gt_right">4.23</td>
      <td class="gt_row gt_right">0.81</td>
      <td class="gt_row gt_right">5.23</td>
      <td class="gt_row gt_right"><0.001</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">4|5</td>
      <td class="gt_row gt_right gt_striped">6.09</td>
      <td class="gt_row gt_right gt_striped">0.97</td>
      <td class="gt_row gt_right gt_striped">6.26</td>
      <td class="gt_row gt_right gt_striped"><0.001</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">tempwarm</td>
      <td class="gt_row gt_right">3.06</td>
      <td class="gt_row gt_right">0.60</td>
      <td class="gt_row gt_right">5.14</td>
      <td class="gt_row gt_right"><0.001</td>
    </tr>
    <tr>
      <td class="gt_row gt_left gt_striped">contactyes</td>
      <td class="gt_row gt_right gt_striped">1.83</td>
      <td class="gt_row gt_right gt_striped">0.51</td>
      <td class="gt_row gt_right gt_striped">3.58</td>
      <td class="gt_row gt_right gt_striped"><0.001</td>
    </tr>
  </tbody>
  
  
</table></div>
<p>Both fixed effect estimates <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span> are higher in the CLMM.
Use <code>anova</code> to compare the CLMM to the CLM:</p>
<pre class="r"><code>anova(
  clm_rating_contact_temp, clmm_rating_contact_temp
)</code></pre>
<pre><code>## Likelihood ratio tests of cumulative link models:
##  
##                          formula:                              link: threshold:
## clm_rating_contact_temp  rating ~ contact + temp               logit flexible  
## clmm_rating_contact_temp rating ~ temp + contact + (1 | judge) logit flexible  
## 
##                          no.par    AIC  logLik LR.stat df Pr(&gt;Chisq)   
## clm_rating_contact_temp       6 184.98 -86.492                         
## clmm_rating_contact_temp      7 177.13 -81.565   9.853  1   0.001696 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Unsurprisingly, the <code>judge</code> term makes a significant improvement to the fit.
We can extract profile confidence intervals on the variance <span class="math inline">\(\sigma_u\)</span> using <code>stats::profile</code>:</p>
<pre class="r"><code>profile(clmm2_rating_contact_temp,
        range = c(0.1, 4), nSteps = 30, trace = 0) %&gt;%
  confint()</code></pre>
<pre><code>##           2.5 %  97.5 %
## stDev 0.5014584 2.26678</code></pre>
<p>Note that these intervals are asymmetric (<span class="math inline">\(\sigma_u\)</span> = 1.31), unlike the less accurate Wald tests.
We can produce “best guess” estimates for <code>judge</code> effects using <em>conditional modes</em>:</p>
<pre class="r"><code>tibble(
  judge_effect = clmm_rating_contact_temp$ranef,
  cond_var = clmm_rating_contact_temp$condVar
) %&gt;%
  mutate(
    judge = fct_reorder(factor(1:n()), judge_effect),
    conf.low = judge_effect - qnorm(0.975) * sqrt(cond_var),
    conf.high = judge_effect + qnorm(0.975) * sqrt(cond_var)
  ) %&gt;%
  ggp(aes(y = judge, x = judge_effect)) +
  geom_point() +
  geom_linerange(aes(xmin = conf.low, xmax = conf.high)) +
  cowplot::theme_minimal_vgrid()</code></pre>
<p><img src="/post/2020-03-15-ordinal-regression-in-r-part-1/index_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<div id="predictions" class="section level4">
<h4>Predictions</h4>
<p>There are different ways to extract predicted probabilities.
First, and most obviously, with the <code>predict</code> function:</p>
<pre class="r"><code>wine %&gt;%
  bind_cols(
    pred =  predict(
      # Have to use clmm2 for predict
      clmm2_rating_contact_temp,
      newdata = wine
    )
  ) %&gt;%
  # These are predicted probabilities for the average judge, so we can
  #  exclude that variable
  distinct(rating, temp, contact, pred) %&gt;%
  arrange(temp, contact, rating)</code></pre>
<pre><code>## # A tibble: 15 x 4
##    rating temp  contact   pred
##    &lt;ord&gt;  &lt;fct&gt; &lt;fct&gt;    &lt;dbl&gt;
##  1 1      cold  no      0.165 
##  2 2      cold  no      0.655 
##  3 3      cold  no      0.166 
##  4 1      cold  yes     0.0305
##  5 2      cold  yes     0.390 
##  6 3      cold  yes     0.496 
##  7 4      cold  yes     0.0696
##  8 2      warm  no      0.166 
##  9 3      warm  no      0.587 
## 10 4      warm  no      0.191 
## 11 5      warm  no      0.0463
## 12 2      warm  yes     0.0313
## 13 3      warm  yes     0.306 
## 14 4      warm  yes     0.428 
## 15 5      warm  yes     0.233</code></pre>
<p>This only gives us predictions for <code>rating</code>, <code>temp</code> and <code>contact</code> values which exist in the data.
There is no predicted probability for <code>rating</code> &gt; 3, <code>temp</code> cold and <code>contact</code> no, for example.
Another way is to pre-specify which values we want to predict:</p>
<pre class="r"><code>nd &lt;-
  crossing(
    temp = factor(c(&quot;cold&quot;, &quot;warm&quot;)),
    contact = factor(c(&quot;no&quot;, &quot;yes&quot;)),
    rating = factor(1:5, ordered = T)
  )
nd %&gt;%
  bind_cols(pred = predict(clmm2_rating_contact_temp, nd)) %&gt;%
  ggplot(aes(x = glue::glue(&quot;{temp}-{contact}&quot;), y = pred, fill = rating)) +
  geom_col() +
  cowplot::theme_minimal_hgrid() +
  scale_y_continuous(expand = c(0, 0), labels = scales::percent) +
  labs(x = &quot;temp-contact&quot;)</code></pre>
<p><img src="/post/2020-03-15-ordinal-regression-in-r-part-1/index_files/figure-html/unnamed-chunk-25-1.png" width="480" /></p>
<p>We can also get model-estimated cumulative probabilities by considering the model coefficients.
For example, for a cold <code>temp</code> and <code>contact</code>, the cumulative probability of a bitterness <code>rating</code> <span class="math inline">\(j\)</span> or less:</p>
<p><span class="math display">\[
P(y_i \leq j) = \text{logit}^{-1} [\theta_j - \beta_2 \text{contact}_i]
\]</span></p>
<p>where we are considering the average judge (<span class="math inline">\(u(\text{judge}_i) = 0\)</span>).
The inverse logit is <span class="math inline">\(\text{logit}^{-1}(x) = 1 / (1 + \exp(-x))\)</span>, and can be calculated with <code>plogis</code> as a shorthand (<code>brms::inv_logit_scaled</code> is another).
We can subtract cumulative probabilities to get non-cumulative probabilities of a rating <span class="math inline">\(j\)</span>.
For example, <span class="math inline">\(j\)</span> = 3:</p>
<pre class="r"><code>plogis(clmm_rating_contact_temp$Theta[3] - clmm_rating_contact_temp$beta[2]) -
  plogis(clmm_rating_contact_temp$Theta[2] - clmm_rating_contact_temp$beta[2])</code></pre>
<pre><code>## contactyes 
##  0.4960357</code></pre>
<p>which matches the value calculated previously using <code>predict</code>.</p>
</div>
<div id="estimated-marginal-means" class="section level4">
<h4>Estimated marginal means</h4>
<p>The <code>emmeans</code> package provides functionality for estimating marginal mean effects of ordinal models.
The package documentation also provides an example using <code>ordinal</code> and <code>wine</code> data <a href="https://cran.r-project.org/web/packages/emmeans/vignettes/sophisticated.html#ordinal">here</a>.</p>
<pre class="r"><code>library(emmeans)</code></pre>
<p>In the “Models supported by <code>emmeans</code>” document, we see the following:</p>
<table>
<colgroup>
<col width="10%" />
<col width="6%" />
<col width="5%" />
<col width="74%" />
<col width="2%" />
</colgroup>
<thead>
<tr class="header">
<th>Object.class</th>
<th>Package</th>
<th>Group</th>
<th>Arguments/notes</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>clm</td>
<td>ordinal</td>
<td>O</td>
<td><code>mode = c("latent", "linear.predictor", "cum.prob", "exc.prob", "prob", "mean.class", "scale")</code></td>
<td></td>
</tr>
<tr class="even">
<td>clmm</td>
<td>ordinal</td>
<td>O</td>
<td>Like <code>clm</code> but no <code>"scale"</code> mode</td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<pre class="r"><code>emmeans(clmm_rating_contact_temp,
        specs = list(pairwise ~ temp, pairwise ~ contact),
        mode = &quot;latent&quot;)</code></pre>
<pre><code>## $`emmeans of temp`
##  temp emmean    SE  df asymp.LCL asymp.UCL
##  cold  -1.63 0.547 Inf    -2.707    -0.562
##  warm   1.43 0.532 Inf     0.387     2.470
## 
## Results are averaged over the levels of: contact 
## Confidence level used: 0.95 
## 
## $`pairwise differences of temp`
##  contrast    estimate    SE  df z.ratio p.value
##  cold - warm    -3.06 0.595 Inf -5.145  &lt;.0001 
## 
## Results are averaged over the levels of: contact 
## 
## $`emmeans of contact`
##  contact emmean    SE  df asymp.LCL asymp.UCL
##  no      -1.020 0.522 Inf    -2.043   0.00274
##  yes      0.815 0.513 Inf    -0.191   1.82072
## 
## Results are averaged over the levels of: temp 
## Confidence level used: 0.95 
## 
## $`pairwise differences of contact`
##  contrast estimate    SE  df z.ratio p.value
##  no - yes    -1.83 0.513 Inf -3.580  0.0003 
## 
## Results are averaged over the levels of: temp</code></pre>
<p>The contrast estimates are in terms of the latent (underlying unobserved) bitterness <code>rating</code>.</p>
<p>Using <code>mode = "cum.prob"</code> and <code>mode = "exc.prob</code>", we can get cumulative probabilites and exceedance (<code>- cumulative) probabilities. For example, the probability of a</code>rating<code>of at least 4 for different</code>temp`:</p>
<pre class="r"><code>emmeans(clmm_rating_contact_temp, ~ temp,
        mode = &quot;exc.prob&quot;, at = list(cut = &quot;3|4&quot;))</code></pre>
<pre><code>##  temp exc.prob     SE  df asymp.LCL asymp.UCL
##  cold    0.049 0.0304 Inf   -0.0107     0.109
##  warm    0.450 0.1084 Inf    0.2371     0.662
## 
## Results are averaged over the levels of: contact 
## Confidence level used: 0.95</code></pre>
<p><code>mode = "prob"</code> gives us probability distributions of each <code>rating</code>:</p>
<pre class="r"><code>emmeans(clmm_rating_contact_temp,
        ~ rating | temp, mode = &quot;prob&quot;) %&gt;%
  plot()</code></pre>
<p><img src="/post/2020-03-15-ordinal-regression-in-r-part-1/index_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
</div>
<div id="choice-of-link-function" class="section level4">
<h4>Choice of link function</h4>
<p>So far, we have used the logit link (and briefly the probit link to compare estimates with linear regression).
The links available to <code>ordinal::clmm</code> are logit, probit, cloglog, loglog, and cauchit.</p>
<p>We can fit the CLMM using all of these links and compare log-likelihoods:</p>
<pre class="r"><code>wine %&gt;%
  nest(everything()) %&gt;%
  crossing(
    link = c(&quot;logit&quot;, &quot;probit&quot;, &quot;cloglog&quot;, &quot;loglog&quot;, &quot;cauchit&quot;)
  ) %&gt;%
  mutate(
    mod = map2(
      data, link,
      ~clmm(
        rating ~ 1 + contact + temp + (1|judge),
        data = .x, link = .y
      )
    )
  ) %&gt;%
  mutate(
    mod_glance = map(mod, glance)
  ) %&gt;%
  unnest(mod_glance) %&gt;%
  select(link, logLik, AIC, BIC) %&gt;%
  arrange(logLik)</code></pre>
<pre><code>## # A tibble: 5 x 4
##   link    logLik   AIC   BIC
##   &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 cauchit  -86.8  188.  204.
## 2 cloglog  -82.7  179.  195.
## 3 logit    -81.6  177.  193.
## 4 loglog   -81.5  177.  193.
## 5 probit   -80.9  176.  192.</code></pre>
<p>The probit model appears to be the best description of the data.</p>
<p>We can also consider the effect of “flexible” vs “equidistant” thresholds:</p>
<pre class="r"><code>wine %&gt;%
  nest(everything()) %&gt;%
  crossing(
    link = c(&quot;logit&quot;, &quot;probit&quot;, &quot;cloglog&quot;, &quot;loglog&quot;, &quot;cauchit&quot;),
    threshold = c(&quot;flexible&quot;, &quot;equidistant&quot;)
  ) %&gt;%
  mutate(
    mod = pmap(
      list(data, link, threshold),
      function(a, b, c) {
        clmm(
          rating ~ 1 + contact + temp + (1|judge),
          data = a, link = b, threshold = c
        )
      }
    )
  ) %&gt;%
  mutate(
    mod_glance = map(mod, glance)
  ) %&gt;%
  unnest(mod_glance) %&gt;%
  select(link, threshold, logLik, edf, AIC, BIC) %&gt;%
  arrange(logLik)</code></pre>
<pre><code>## # A tibble: 10 x 6
##    link    threshold   logLik   edf   AIC   BIC
##    &lt;chr&gt;   &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 cauchit equidistant  -87.8     5  186.  197.
##  2 cauchit flexible     -86.8     7  188.  204.
##  3 loglog  equidistant  -84.4     5  179.  190.
##  4 cloglog equidistant  -83.3     5  177.  188.
##  5 logit   equidistant  -83.1     5  176.  187.
##  6 cloglog flexible     -82.7     7  179.  195.
##  7 probit  equidistant  -82.5     5  175.  186.
##  8 logit   flexible     -81.6     7  177.  193.
##  9 loglog  flexible     -81.5     7  177.  193.
## 10 probit  flexible     -80.9     7  176.  192.</code></pre>
<p>Note the change in degrees of freedom, resulting in the equidistant probit model having the lowest BIC.
In terms of log likelihood, however, flexible always outperform equidistant thresholds.</p>
</div>
</div>
</div>
</div>
<div id="conclusion" class="section level1">
<h1>Conclusion</h1>
<p>Thanks to detailed documentation, fitting cumulative link (mixed) models is very easy with <code>ordinal</code>.
In this post, we first learned the theoretical basis for these models, then worked through examples using <code>wine</code> bitterness ratings from multiple judges.</p>
<p>In the next post, I’ll explore the Bayesian approach to ordinal regression with the <code>brms</code> package.</p>
</div>
<div id="session-info" class="section level1">
<h1>Session info</h1>
<pre class="r"><code>devtools::session_info()</code></pre>
<pre><code>## - Session info ---------------------------------------------------------------
##  setting  value                       
##  version  R version 3.6.2 (2019-12-12)
##  os       Windows 10 x64              
##  system   x86_64, mingw32             
##  ui       RTerm                       
##  language (EN)                        
##  collate  English_Canada.1252         
##  ctype    English_Canada.1252         
##  tz       America/Curacao             
##  date     2020-03-16                  
## 
## - Packages -------------------------------------------------------------------
##  package      * version     date       lib source                          
##  assertthat     0.2.1       2019-03-21 [1] CRAN (R 3.6.0)                  
##  backports      1.1.5       2019-10-02 [1] CRAN (R 3.6.1)                  
##  blogdown       0.18        2020-03-04 [1] CRAN (R 3.6.2)                  
##  bookdown       0.18        2020-03-05 [1] CRAN (R 3.6.2)                  
##  broom        * 0.5.4       2020-01-27 [1] CRAN (R 3.6.2)                  
##  callr          3.2.0       2019-03-15 [1] CRAN (R 3.6.0)                  
##  cellranger     1.1.0       2016-07-27 [1] CRAN (R 3.6.0)                  
##  checkmate      1.9.3       2019-05-03 [1] CRAN (R 3.6.0)                  
##  cli            2.0.2       2020-02-28 [1] CRAN (R 3.6.3)                  
##  coda           0.19-3      2019-07-05 [1] CRAN (R 3.6.1)                  
##  codetools      0.2-16      2018-12-24 [2] CRAN (R 3.6.2)                  
##  colorspace     1.4-1       2019-03-18 [1] CRAN (R 3.6.0)                  
##  cowplot        1.0.0       2019-07-11 [1] CRAN (R 3.6.1)                  
##  crayon         1.3.4       2017-09-16 [1] CRAN (R 3.6.0)                  
##  DBI            1.0.0       2018-05-02 [1] CRAN (R 3.6.0)                  
##  dbplyr         1.4.2       2019-06-17 [1] CRAN (R 3.6.2)                  
##  desc           1.2.0       2018-05-01 [1] CRAN (R 3.6.0)                  
##  devtools       2.0.2       2019-04-08 [1] CRAN (R 3.6.0)                  
##  digest         0.6.25      2020-02-23 [1] CRAN (R 3.6.2)                  
##  dplyr        * 0.8.99.9000 2020-03-11 [1] Github (tidyverse/dplyr@e1f32c8)
##  ellipsis       0.3.0       2019-09-20 [1] CRAN (R 3.6.1)                  
##  emmeans      * 1.4.4       2020-01-28 [1] CRAN (R 3.6.2)                  
##  estimability   1.3         2018-02-11 [1] CRAN (R 3.6.0)                  
##  evaluate       0.13        2019-02-12 [1] CRAN (R 3.6.0)                  
##  fansi          0.4.1       2020-01-08 [1] CRAN (R 3.6.2)                  
##  farver         2.0.3       2020-01-16 [1] CRAN (R 3.6.2)                  
##  forcats      * 0.4.0       2019-02-17 [1] CRAN (R 3.6.0)                  
##  fs             1.3.1       2019-05-06 [1] CRAN (R 3.6.0)                  
##  generics       0.0.2       2018-11-29 [1] CRAN (R 3.6.0)                  
##  ggplot2      * 3.3.0       2020-03-05 [1] CRAN (R 3.6.2)                  
##  glue           1.3.2       2020-03-11 [1] Github (tidyverse/glue@5010cc6) 
##  gt           * 0.1.0       2020-02-25 [1] Github (rstudio/gt@9782e79)     
##  gtable         0.3.0       2019-03-25 [1] CRAN (R 3.6.0)                  
##  haven          2.2.0       2019-11-08 [1] CRAN (R 3.6.2)                  
##  here         * 0.1         2017-05-28 [1] CRAN (R 3.6.0)                  
##  hms            0.5.3       2020-01-08 [1] CRAN (R 3.6.2)                  
##  htmltools      0.3.6       2017-04-28 [1] CRAN (R 3.6.0)                  
##  httr           1.4.1       2019-08-05 [1] CRAN (R 3.6.2)                  
##  jsonlite       1.6.1       2020-02-02 [1] CRAN (R 3.6.2)                  
##  knitr          1.28        2020-02-06 [1] CRAN (R 3.6.2)                  
##  labeling       0.3         2014-08-23 [1] CRAN (R 3.6.0)                  
##  lattice        0.20-38     2018-11-04 [2] CRAN (R 3.6.2)                  
##  lifecycle      0.2.0       2020-03-06 [1] CRAN (R 3.6.2)                  
##  lubridate      1.7.4       2018-04-11 [1] CRAN (R 3.6.0)                  
##  magrittr       1.5         2014-11-22 [1] CRAN (R 3.6.0)                  
##  MASS           7.3-51.4    2019-03-31 [2] CRAN (R 3.6.2)                  
##  Matrix         1.2-18      2019-11-27 [2] CRAN (R 3.6.2)                  
##  memoise        1.1.0       2017-04-21 [1] CRAN (R 3.6.0)                  
##  modelr         0.1.5       2019-08-08 [1] CRAN (R 3.6.2)                  
##  multcomp       1.4-12      2020-01-10 [1] CRAN (R 3.6.2)                  
##  munsell        0.5.0       2018-06-12 [1] CRAN (R 3.6.0)                  
##  mvtnorm        1.0-11      2019-06-19 [1] CRAN (R 3.6.0)                  
##  nlme           3.1-140     2019-05-12 [1] CRAN (R 3.6.0)                  
##  numDeriv       2016.8-1.1  2019-06-06 [1] CRAN (R 3.6.0)                  
##  ordinal      * 2019.12-10  2019-12-15 [1] CRAN (R 3.6.3)                  
##  patchwork    * 1.0.0       2019-12-01 [1] CRAN (R 3.6.2)                  
##  pillar         1.4.3       2019-12-20 [1] CRAN (R 3.6.2)                  
##  pkgbuild       1.0.3       2019-03-20 [1] CRAN (R 3.6.0)                  
##  pkgconfig      2.0.3       2019-09-22 [1] CRAN (R 3.6.1)                  
##  pkgload        1.0.2       2018-10-29 [1] CRAN (R 3.6.0)                  
##  plyr           1.8.5       2019-12-10 [1] CRAN (R 3.6.2)                  
##  prettyunits    1.0.2       2015-07-13 [1] CRAN (R 3.6.0)                  
##  processx       3.3.0       2019-03-10 [1] CRAN (R 3.6.0)                  
##  ps             1.3.0       2018-12-21 [1] CRAN (R 3.6.0)                  
##  purrr        * 0.3.3       2019-10-18 [1] CRAN (R 3.6.2)                  
##  R6             2.4.1       2019-11-12 [1] CRAN (R 3.6.1)                  
##  RColorBrewer   1.1-2       2014-12-07 [1] CRAN (R 3.6.0)                  
##  Rcpp           1.0.3       2019-11-08 [1] CRAN (R 3.6.1)                  
##  readr        * 1.3.1       2018-12-21 [1] CRAN (R 3.6.0)                  
##  readxl         1.3.1       2019-03-13 [1] CRAN (R 3.6.0)                  
##  remotes        2.0.4       2019-04-10 [1] CRAN (R 3.6.0)                  
##  reprex         0.3.0       2019-05-16 [1] CRAN (R 3.6.2)                  
##  rlang          0.4.5       2020-03-01 [1] CRAN (R 3.6.2)                  
##  rmarkdown      2.1         2020-01-20 [1] CRAN (R 3.6.2)                  
##  rprojroot      1.3-2       2018-01-03 [1] CRAN (R 3.6.0)                  
##  rstudioapi     0.11        2020-02-07 [1] CRAN (R 3.6.2)                  
##  rvest          0.3.5       2019-11-08 [1] CRAN (R 3.6.2)                  
##  sandwich       2.5-1       2019-04-06 [1] CRAN (R 3.6.0)                  
##  sass           0.1.0.9000  2019-05-07 [1] Github (rstudio/sass@c3ba17c)   
##  scales         1.1.0       2019-11-18 [1] CRAN (R 3.6.1)                  
##  sessioninfo    1.1.1       2018-11-05 [1] CRAN (R 3.6.0)                  
##  stringi        1.4.6       2020-02-17 [1] CRAN (R 3.6.2)                  
##  stringr      * 1.4.0       2019-02-10 [1] CRAN (R 3.6.0)                  
##  survival       3.1-8       2019-12-03 [2] CRAN (R 3.6.2)                  
##  testthat       2.3.0       2019-11-05 [1] CRAN (R 3.6.1)                  
##  TH.data        1.0-10      2019-01-21 [1] CRAN (R 3.6.0)                  
##  tibble       * 2.1.3       2019-06-06 [1] CRAN (R 3.6.1)                  
##  tidyr        * 1.0.2       2020-01-24 [1] CRAN (R 3.6.2)                  
##  tidyselect     1.0.0       2020-01-27 [1] CRAN (R 3.6.2)                  
##  tidyverse    * 1.3.0       2019-11-21 [1] CRAN (R 3.6.3)                  
##  ucminf         1.1-4       2016-08-18 [1] CRAN (R 3.6.0)                  
##  usethis        1.5.1       2019-07-04 [1] CRAN (R 3.6.3)                  
##  utf8           1.1.4       2018-05-24 [1] CRAN (R 3.6.0)                  
##  vctrs          0.2.99.9010 2020-03-11 [1] Github (r-lib/vctrs@63b2712)    
##  viridisLite    0.3.0       2018-02-01 [1] CRAN (R 3.6.0)                  
##  withr          2.1.2       2018-03-15 [1] CRAN (R 3.6.0)                  
##  xfun           0.12        2020-01-13 [1] CRAN (R 3.6.3)                  
##  xml2           1.2.2       2019-08-09 [1] CRAN (R 3.6.2)                  
##  xtable         1.8-4       2019-04-21 [1] CRAN (R 3.6.0)                  
##  yaml           2.2.0       2018-07-25 [1] CRAN (R 3.6.0)                  
##  zoo            1.8-5       2019-03-21 [1] CRAN (R 3.6.0)                  
## 
## [1] D:/Taylor/Documents/R/win-library/3.6
## [2] C:/Program Files/R/R-3.6.2/library</code></pre>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references hanging-indent">
<div id="ref-Randall1989">
<p>Randall, J. H. 1989. “The Analysis of Sensory Data by Generalized Linear Model.” <em>Biometrical Journal</em> 31 (7): 781–93. <a href="https://doi.org/10.1002/bimj.4710310703">https://doi.org/10.1002/bimj.4710310703</a>.</p>
</div>
</div>
</div>
