---
title: 'Paper review: Adjusted age-specific case fatality ratio during the COVID-19
  epidemic'
author: Taylor Dunn
date: '2020-03-08'
slug: paper-review-covid-19-epidemic
categories: []
tags: []
bibliography: references.bib
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p>This post is a re-creation of the 2020 preprint <span class="citation">(Riou et al. 2020)</span>.</p>
<ul>
<li>The PDF is available
<a href="https://www.medrxiv.org/content/10.1101/2020.03.04.20031104v1.full.pdf">here</a>.</li>
<li>Data and code are availalbe <a href="https://github.com/jriou/covid_adjusted_cfr">here</a>.</li>
<li>Andrew Gelman’s blog post on the paper is
<a href="https://statmodeling.stat.columbia.edu/2020/03/07/coronavirus-age-specific-fatality-ratio-estimated-using-stan/">here</a>.</li>
</ul>
<p>The reason I’m reviewing it is because (A) COVID-19 is scary and (B) I wanted to learn more Stan, or specifically, the limits of complexity in Stan.</p>
<p>Import the data:</p>
<pre class="r"><code>confirmed_cases &lt;-
  read_csv(
    &quot;https://raw.githubusercontent.com/jriou/covid_adjusted_cfr/master/data/confirmed_cases.csv&quot;
  )</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   day = col_double(),
##   month = col_double(),
##   year = col_double(),
##   confirmed_cases_china = col_double(),
##   confimed_cases_outside_hubei_with_link = col_double(),
##   confimed_cases_outside_hubei_without_link = col_double(),
##   confirmed_cases_hubei = col_double()
## )</code></pre>
<pre class="r"><code>japan_clean &lt;-
  read_csv(
    &quot;https://raw.githubusercontent.com/jriou/covid_adjusted_cfr/master/data/japan_clean.csv&quot;
  )</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   id = col_double(),
##   age = col_character(),
##   sex = col_character(),
##   date = col_date(format = &quot;&quot;)
## )</code></pre>
<pre class="r"><code># What is this for?
age_structure &lt;-
  readxl::read_xlsx(
    here(&quot;data&quot;, &quot;age_structure.xlsx&quot;)
  )</code></pre>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<ul>
<li>Overall case fatality ratio (CFR): the proportion of all (asymptomatic and symptomatic) infected cases that will die as a result of the disease.</li>
<li>A crude CFR of 2.3% was estimated based on 1023 deaths out of 44672 confirmed cases.</li>
<li>Difficult to interpret due to
<ul>
<li>likely under-ascertainment of mild or asymptomatic cases and</li>
<li>right-censoring of cases with respect to the time delay from illness onset to death.</li>
</ul></li>
<li>Other analyses have reported estimates of 7.2%, 5.3%, 18%, and 1%.</li>
<li>The authors attempted to fit a dynamic transmission model to reported data of confirmed cases and deaths in Hubei. They obtained adjusted and age-specific estimates of the overall CFR of COVID-19 among both symptomatic and asymptomatic patients in the Hubei province until 11 February 2020.</li>
</ul>
</div>
<div id="the-covid-19-epidemic-in-hubei-china" class="section level1">
<h1>The COVID-19 epidemic in Hubei, China</h1>
<blockquote>
<p>Human-to-human transmission occured at a high rate in Wuhan and other areas of the Hubei province, leading to an exponential growth of incidence (Figure 1A).</p>
</blockquote>
<p>To re-create Figure 1, we use the provided <code>confirmed_cases</code> data:</p>
<pre class="r"><code>head(confirmed_cases)</code></pre>
<pre><code>## # A tibble: 6 x 7
##     day month  year confirmed_cases~ confimed_cases_~ confimed_cases_~
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
## 1     8    12  2019                1                0                0
## 2     9    12  2019                0                0                0
## 3    10    12  2019                0                0                0
## 4    11    12  2019                1                0                0
## 5    12    12  2019                3                0                0
## 6    13    12  2019                0                0                0
## # ... with 1 more variable: confirmed_cases_hubei &lt;dbl&gt;</code></pre>
<p>There are four count variables: <code>confirmed_cases_china</code>, <code>confirmed_cases_outside_hubei_with_link</code>, <code>confirmed_cases_outside_hubei_without_link</code>, and <code>confirmed_cases_hubei</code>.
Create a <code>date</code> type object, and plot the counts:</p>
<pre class="r"><code>confirmed_cases  &lt;-
  confirmed_cases %&gt;%
  mutate(
    date = as.Date(
      glue(&quot;{year}-{month}-{day}&quot;)      
    )
  )
confirmed_cases %&gt;%
  gather(var, count, confirmed_cases_china:confirmed_cases_hubei) %&gt;%
  ggp(aes(x = date, y = count)) +
  geom_col() +
  facet_wrap(~ var, ncol = 2, scales = &quot;free_y&quot;) +
  scale_y_continuous(expand = expansion(c(0, 0)))</code></pre>
<p><img src="/post/2020-03-08-paper-review-adjusted-age-specific-case-fatality-ratio-during-the-covid-19-epidemic_files/figure-html/unnamed-chunk-3-1.png" width="768" /></p>
<p>The extra count of deaths in Hubei come from an R query package <a href="https://github.com/GuangchuangYu/nCov2019">nCov2019</a>, which were hard-coded by the authors into this list:</p>
<pre class="r"><code>reported_deaths &lt;- c(
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 1, 2, 3, 7, 7, 14, 13,
  21, 23, 23, 33, 38, 40, 40, 50, 56, 58, 64, 64, 76, 78, 85, 95, 85
)</code></pre>
<p>There are 42 time points in the <code>reported_deaths</code> data, but the <code>confirmed_cases</code> data spans 66.
If we assume that these 42 are the most recent, then they correspond to the date range
2020-01-01 to
2020-02-11.
Add this to the <code>confirmed_cases</code> data, and fill for earlier dates:</p>
<pre class="r"><code>confirmed_cases &lt;-
  confirmed_cases %&gt;%
  left_join(
    tibble(
      reported_deaths = reported_deaths,
      date = seq.Date(
        min(tail(confirmed_cases$date, length(reported_deaths))),
        max(confirmed_cases$date),
        &quot;days&quot;
      )
    ),
    by = &quot;date&quot;
  ) %&gt;%
  mutate(reported_deaths = replace_na(reported_deaths, 0))</code></pre>
<p>Note that this corresponds to the first death occuring on 2020-01-13, but the first was reported to occur on
<a href="https://www.straitstimes.com/asia/east-asia/china-reports-first-death-in-wuhan-pneumonia-outbreak">January 9th in Wuhan</a>.</p>
<p>Create Figure 1A with the <code>confirmed_cases_hubei</code> variable:</p>
<pre class="r"><code>fig1a &lt;-
  confirmed_cases %&gt;%
  ggp(aes(x = date, y = confirmed_cases_hubei)) +
  geom_col(color = &quot;black&quot;) +
  geom_col(aes(y = reported_deaths), fill = &quot;firebrick&quot;, color = &quot;black&quot;) +
  geom_vline(xintercept = as.Date(&quot;2020-01-20&quot;), lty = 2, size = 1) + 
  geom_vline(xintercept = max(confirmed_cases$date), lty = 2, size = 1) + 
  scale_y_continuous(&quot;N&quot;, limits = c(0, 3000),
                     expand = expansion(c(0, 0))) +
  labs(x = &quot;Time&quot;)
fig1a</code></pre>
<p><img src="/post/2020-03-08-paper-review-adjusted-age-specific-case-fatality-ratio-during-the-covid-19-epidemic_files/figure-html/fig1a-1.png" width="672" /></p>
<p>To construct the three subplots for Figure 1B, we use hard-coded data, binned by age, from the
<a href="https://www.worldometers.info/demographics/china-demographics/">worldometer</a> and
<a href="https://github.com/jriou/covid_adjusted_cfr/blob/master/data/chineseCDC2020.pdf">Chinese CDC Weekly</a>:</p>
<pre class="r"><code>fig1b_data &lt;-
  tibble(
    age_range = factor(
      c(
        &quot;0-9&quot;, &quot;10-19&quot;, &quot;20-29&quot;, &quot;30-39&quot;, &quot;40-49&quot;,
        &quot;50-59&quot;, &quot;60-69&quot;, &quot;70-79&quot;, &quot;80+&quot;
      ),
      ordered = T
    )
  ) %&gt;%
  # Chinese age_distribution from worldometer
  bind_cols(
    `Chinese population` = c(
      83932437 + 86735183,
      84262751 + 82341859,
      87158167+ 97989003,
      128738970 + 100091455, 
      96274146 + 119837617,
      123445382 + 98740491,
      77514139 + 74149766,
      44949689 + 26544616,
      16181417 + 7581777 + 2305024 + 475193 + 74692
    )
  ) %&gt;%
  # Confirmed cases from CDC
  bind_cols(
    `Confirmed cases` = c(
      416, 549, 3619, 7600, 8571, 10008, 8583, 3918, 1408
    )
  ) %&gt;%
  # Reported deaths from CDC
  bind_cols(
    `Reported deaths` = c(
      0, 1, 7, 18, 38, 130, 309, 312, 208
    )
  ) %&gt;%
  gather(var, count, -age_range) %&gt;%
  group_by(var) %&gt;%
  mutate(prop = count / sum(count))
fig1b &lt;- fig1b_data %&gt;%
  ggp(aes(y = age_range, x = prop)) +
  geom_col() +
  facet_wrap(~var) +
  scale_x_continuous(&quot;Proportion&quot;, labels = scales::percent,
                     expand = expansion(c(0, 0))) +
  scale_y_discrete(NULL, expand = expansion(c(0, 0)))
fig1b</code></pre>
<p><img src="/post/2020-03-08-paper-review-adjusted-age-specific-case-fatality-ratio-during-the-covid-19-epidemic_files/figure-html/fig1b-1.png" width="672" /></p>
<p>Data for Figure 1C come from the <a href="https://www.niid.go.jp/niid/en/2019-ncov-e/9407-covid-dp-fe-01.html">Japanese National Institute of Infectious Diseases</a>, and a cleaned version of the data (<code>japan_clean</code>) was provided by the authors:</p>
<pre class="r"><code>japan_clean</code></pre>
<pre><code>## # A tibble: 161 x 4
##       id age   sex    date      
##    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  &lt;date&gt;    
##  1   161 60    female 2020-02-25
##  2   160 50    male   2020-02-25
##  3   159 60    female 2020-02-25
##  4   158 60    male   2020-02-25
##  5   157 50    female 2020-02-24
##  6   156 30    male   2020-02-24
##  7   155 50    male   2020-02-24
##  8   154 40    male   2020-02-24
##  9   153 50    male   2020-02-24
## 10   152 50    male   2020-02-24
## # ... with 151 more rows</code></pre>
<p>The <code>age</code> variable has some non-numeric variables: 0-10 and ??.
The data are already seemingly binned into decades (values of 10, 20, 30, etc.), but we will re-label to match the figure (values of 10-19, 20-29, 30-39, etc.):</p>
<pre class="r"><code>japan_clean &lt;- 
  japan_clean %&gt;%
  mutate(
    # Impute as the midpoint
    age = as.numeric(str_replace(age, &quot;0-10&quot;, &quot;5&quot;))
  ) %&gt;%
  mutate(
    age_range = cut(
      age,
      breaks = c(0, 9, 19, 29, 39, 49, 59, 69, 79, 100),
      labels = levels(fig1b_data$age_range)
    )
  )</code></pre>
<p>This cleaned data doesn’t have the sympomatic status, however.
Looking through the <a href="https://github.com/jriou/covid_adjusted_cfr/blob/master/output_paper.R">source code</a>, I found the following hard-coded values for the Diamond Pricess ship:</p>
<pre class="r"><code>diamond_symptoms &lt;-
  tibble(
    symptomatic = c(0, 2, 25, 27, 19, 28, 76, 95, 29),
    asymptomatic = c(1, 3, 3, 7, 8, 31, 101, 139, 25),
    age_range = factor(levels(fig1b_data$age_range), ordered = T)
  ) %&gt;%
  mutate(
    symptomatic_prop = symptomatic / (symptomatic + asymptomatic),
    prop_inf = qbeta(0.025, symptomatic+1, asymptomatic+1),
    prop_sup = qbeta(0.975, symptomatic+1, asymptomatic+1),
    var = &quot;Symptomatics&quot;
  )
fig1c &lt;-
  diamond_symptoms %&gt;%
  ggp(aes(x = symptomatic_prop, y = age_range)) +
  geom_col() +
  geom_errorbar(aes(xmin = prop_inf, xmax = prop_sup), size = 1, width = 0.3) +
  geom_vline(xintercept = 0.5, lty = 2, size = 1) +
  facet_wrap(~var) +
  scale_x_continuous(&quot;Proportion&quot;, expand = expansion(c(0, 0.02)),
                     labels = scales::percent, limits = c(0, 1)) +
  scale_y_discrete(NULL, expand = expansion(c(0, 0)))
fig1c</code></pre>
<p><img src="/post/2020-03-08-paper-review-adjusted-age-specific-case-fatality-ratio-during-the-covid-19-epidemic_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Note that the credible intervals are generated using <code>qbeta(c(0.025, 0.975), count1, count2)</code>.</p>
<p>Now we can compile all of Figure 1:</p>
<pre class="r"><code>fig1a + fig1b + fig1c +
  plot_layout(ncol = 1) +
  plot_annotation(tag_levels = &quot;A&quot;)</code></pre>
<p><img src="/post/2020-03-08-paper-review-adjusted-age-specific-case-fatality-ratio-during-the-covid-19-epidemic_files/figure-html/unnamed-chunk-9-1.png" width="768" /></p>
</div>
<div id="an-age-structured-model-of-covid-19-transmission-and-mortality" class="section level1">
<h1>An age-structured model of COVID-19 transmission and mortality</h1>
<p>An age-stratified susceptible-exposed-infected-remove (SEIR) compartmental model was used to simulate the dynamics of the epidemic with:</p>
<ul>
<li>data from 2020-01-01 to 2020-02-11,</li>
<li>a distinction between asymptomatic and symptomatic infections,</li>
<li>age stratified into 10-year ranges (0-9 years, …, 80+ years),</li>
<li>parameter assumptions, identical across ages):
<ul>
<li>incubation period of 5.6 days,</li>
<li>49% of infected people develop symptoms and become infectious (the remaining are asymptomatic and do not transmit further),</li>
<li>time from onset to removal of 2.9 days</li>
</ul></li>
</ul>
<p><img src="/post/2020-03-08-paper-review-adjusted-age-specific-case-fatality-ratio-during-the-covid-19-epidemic_files/riou2020_figure2.png" width="800" /></p>
<p>After 2020-02-20, transmission decrease was modeled using a sigmoid function with four parameters:</p>
<ul>
<li>initial transmission rate,</li>
<li>decrease in transmission due to control measures,</li>
<li>time delay between implementation and effect, and</li>
<li>slope of this decrease.</li>
</ul>
<p>It was assumed that symptomatic people had an age-specific case-fatality rate and that time from onset to death followed a log-normal distribution with mean 20.2 days and SD 11.6.
Thus, number of deaths could be estimated after 2020-02-11.</p>
<p>The model was fitted to four data sets from the CCDC report:</p>
<ol style="list-style-type: decimal">
<li>the number of confirmed cases by day of disease onset,</li>
<li>the number of deaths by day of occurence,</li>
<li>the age distribution of all confirmed cases, and</li>
<li>the age distribution of all deaths.</li>
</ol>
<p>Some additional assumptions and details:</p>
<ul>
<li>assumed that all deaths were reported,</li>
<li>assumed that all symptomatic cases among people 80+ were reported.</li>
<li>For the other age groups, the underreporting of symptomatic cases was modeled with an age-dependent reporting rate.</li>
<li>Negative binomial distributions were used to describe the number of reported cases and deaths, and</li>
<li>multinomial distributions to describe the distribution of cases and deaths over age groups.</li>
</ul>
<div id="walking-through-the-r-code" class="section level2">
<h2>Walking through the R code</h2>
<p>With all of this detail in mind, go step-by-step through the <code>run_models.R</code>:</p>
<pre class="r"><code>source(&quot;data_management.R&quot;)
source(&quot;setup.R&quot;)

# Model 10 ----------------------------------------------------------

# get gamma from discretizing onset_to_death in Linton
linton_mean = 20.2
linton_sd = 11.6

get_par_lnorm = function(m,s) {
  mu = log(m) - 1/2*log((s/m)^2+1)
  sigma = sqrt(log((s/m)^2+1))
  return(list(mu=mu,sigma=sigma))
}
linton_pars = get_par_lnorm(linton_mean,linton_sd)</code></pre>
<p>After sourcing some pre-processing files, define the parameters of the log-normal distribution of time from onset to death are defined.
These values give us:</p>
<pre class="r"><code>linton_mean &lt;- 20.2
linton_sd &lt;- 11.6

mu &lt;- log(linton_mean) - 0.5 * log((linton_sd / linton_mean)^2 + 1)
sigma &lt;- sqrt(log((linton_sd / linton_mean)^2 + 1))
mu; sigma</code></pre>
<pre><code>## [1] 2.863179</code></pre>
<pre><code>## [1] 0.5338606</code></pre>
<p>Plot the lognormal distribution:</p>
<pre class="r"><code>tibble(
  x = seq(0, 50, 0.1),
  d = dlnorm(x, meanlog = mu, sdlog = sigma)
) %&gt;%
  ggp(aes(x, d)) +
  geom_line()</code></pre>
<p><img src="/post/2020-03-08-paper-review-adjusted-age-specific-case-fatality-ratio-during-the-covid-19-epidemic_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>Density looks reasonable.
If we take many random samples, we should recover the original 20.2 ± 11.6:</p>
<pre class="r"><code>tibble(
  val = rlnorm(n = 10000, meanlog = mu, sdlog = sigma)
) %&gt;%
  summarise(mean = mean(val), sd = sd(val))</code></pre>
<pre><code>## # A tibble: 1 x 2
##    mean    sd
##   &lt;dbl&gt; &lt;dbl&gt;
## 1  20.2  11.8</code></pre>
<p>The next bit of code uses the Linton parameters to compute 60 differences in probabilities through <code>plnorm</code>:</p>
<pre class="r"><code>gamma = numeric(60)
for(i in 1:60) {
  gamma[i] = plnorm(i+.5,linton_pars$mu,linton_pars$sigma)-plnorm(i-.5,linton_pars$mu,linton_pars$sigma)
}
gamma = gamma/sum(gamma)
plot(density(rlnorm(1000,linton_pars$mu,linton_pars$sigma)))
lines(gamma,col=&quot;red&quot;)</code></pre>
<p>This <code>gamma</code> variable is the <span class="math inline">\(\gamma\)</span> variable from Figure 2: the delay from disease onset to death discretized by day.
So I think these are probabilities of death (or <span class="math inline">\(\gamma\)</span>) for 1 to 60 days from disease onset:</p>
<pre class="r"><code>tibble(
  i = 1:60
) %&gt;%
  mutate(
    gamma = plnorm(i + 0.5, mu, sigma) - plnorm(i - 0.5, mu, sigma)
  ) %&gt;%
  # Normalize
  mutate(gamma = gamma / sum(gamma)) %&gt;%
  ggp(aes(i, gamma)) +
  geom_line() +
  labs(x = &quot;Day from disease onset&quot;, y = expression(paste(&quot;p(&quot;, gamma, &quot;)&quot;)))</code></pre>
<p><img src="/post/2020-03-08-paper-review-adjusted-age-specific-case-fatality-ratio-during-the-covid-19-epidemic_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<pre class="r"><code># Format data and set priors
data_list_model10 = list(
  time_lag=100,
  K=9,
  age_dist=age_dist,
  pop_t = pop_t,
  t0=0,
  t_data = t_data,
  tmax =tmax,
  tmax2 = tmax,
  tswitch = tswitch,
  S=S,
  ts = 1:S,
  D = D,
  incidence_cases = incidence_cases,
  incidence_deaths = incidence_deaths,
  agedistr_cases = cases_tmax,
  agedistr_deaths = mort_tmax,
  p_beta=1,
  p_eta=c(1,1),
  p_pi=c(1,999),
  p_incubation=5.6, # Incubation including WR (Linton)
  p_infectious=2.9, # Infectious period (Liu)
  p_psi=0.49, # Diamond princess
  p_epsilon=c(1,1),
  p_phi = 1/100,
  p_rho=c(1,1),
  p_xi=1,
  p_nu=1/5,
  G=60,
  p_gamma=gamma,
  inference=0,
  doprint=0
)</code></pre>
<p>This list are the inputs to the Stan model, for which we will refer to <code>data_management</code>:</p>
<pre class="r"><code>day_start = as.Date(&quot;2019-12-30&quot;)
day_data = as.Date(&quot;2019-12-08&quot;)
if(day_data&lt;=day_start) day_data = day_start + 2 # 2020-01-01
day_tmax = as.Date(&quot;2020-02-11&quot;)
day_tswitch = as.Date(&quot;2020-01-23&quot;)
time_lag = 100

t0 = 0
tmax = as.numeric(day_tmax-day_start) # day 43
S = tmax+time_lag # day 143
ts = 1:S # days 1:143
t_data = as.numeric(day_data-day_start) # day 2
D = tmax-t_data+1 # 42 days
tswitch = as.numeric(day_tswitch-day_start) # day 24</code></pre>
<p>A bit confusing without comments.
It seems that the “start day” (<code>day_start</code>) was different from the “data start day” (<code>day_data</code>), which evaluated to 2020-01-01 in the above code.</p>
<p>I first thought that <code>day_tswitch</code> = 2020-01-23 refered to the “Control measures implemented” in Figure 1A, but this is actually 2020-01-20.
Perhaps this date corresponds to the traffic restrictions, quote below:</p>
<blockquote>
<p>On 20 January, Chinese authorities implemented strict control measures in the Hubei province, including contact tracing aimed at identifying , treating and isolating cases and quarantining contacts, extension of holidays, temperature checks before accessing public areas, cancellation of mass gatherings and the promotion of extreme social distancing [10]. Three days later, a cordon sanitaire was imposed, with strict traffic restrictions. From</p>
</blockquote>
<p><code>time_lag</code> extends the time frame by beyond <code>tmax</code> an extra 100 days, to 2020-05-21, which isn’t actually plotted in Figure 3A and 3C, but maybe the axis was cutoff in April.</p>
<p>The calculated values, as I understand them:</p>
<ul>
<li><code>tmax</code> is the number of days from start to <code>tmax</code> (43),</li>
<li><code>S</code> is the total number of days considered, 100 days beyond <code>tmax</code>,</li>
<li><code>ts</code> is a vector of those 43+100 days,</li>
<li><code>t_data</code> is the day on which data starts being collected (day 2),</li>
<li><code>D</code> is the number of days with data + 1 (42)</li>
<li><code>tswitch</code> is the day on which control measures + traffic restrictions were in place (24)</li>
</ul>
<p>With that in mind, I’ll use some descriptive variable names:</p>
<pre class="r"><code>start_date = as.Date(&quot;2019-12-30&quot;)
data_start_date &lt;- start_date + 2 # 2020-01-01
end_date &lt;- as.Date(&quot;2020-02-11&quot;)
controls_date &lt;- as.Date(&quot;2020-01-23&quot;)
extra_days &lt;- 100

start_day &lt;- 0
end_day &lt;- as.numeric(end_date - start_date) # 43
extra_end_day &lt;- end_day + extra_days # 143
days &lt;- 1:extra_end_day # 1:143
data_start_day &lt;- as.numeric(data_start_date - start_date) # 2
data_days &lt;- end_day - data_start_day + 1 # 42
controls_day &lt;- as.numeric(controls_date - start_date) # 24</code></pre>
<p>Moving on:</p>
<pre class="r"><code># Age distribution in China for 9 age classes ---------
# (https://www.worldometers.info/demographics/china-demographics/) 

age_dist&lt;- c(
  83932437 + 86735183,
  84262751 + 82341859,
  87158167+ 97989003,
  128738970 + 100091455, 
  96274146 + 119837617,
  123445382 + 98740491,
  77514139 + 74149766,
  44949689 + 26544616,
  16181417 + 7581777 + 2305024 + 475193 + 74692)
age_dist&lt;-age_dist/sum(age_dist)</code></pre>
<p>This is the data we hard-coded earlier for Figure 1B, <code>fig1b_data</code>; specifically, the first panel of “Chinese population”.</p>
<pre class="r"><code># Population in Hubei ---------
# (National Bureau of Statistics of China) 
pop_t = 59020000</code></pre>
<p>As it says in the header, this is simply the population of Hubei.</p>
<pre class="r"><code># Case incidence in Hubei up to 2020-02-11 ---------
# (Chinese CDC Weekly, The epidemiological characteristics of an outbreak...)

confirmed_cases = read.csv(&quot;data/confirmed_cases.csv&quot;) %&gt;%
  tbl_df() %&gt;%
  mutate(date=ymd(paste(year,month,day,sep=&quot;-&quot;))) %&gt;%
  filter(date&gt;=day_data)
incidence_cases = pull(confirmed_cases,confirmed_cases_hubei)</code></pre>
<p>This is the number of cases over time in Hubei, as shown in Figure 1A, but just taking data from the data start day 2020-01-01 and later.</p>
<pre class="r"><code>incidence_deaths = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 1, 2, 3, 7, 7, 14, 13, 21, 23, 23, 33, 38, 40, 40, 50, 56, 58, 64,
                     64, 76, 78, 85, 95, 85)</code></pre>
<p>These were the death counts over time in Hubei, also in Figure 1A.
The number of hard-coded values above is 42, which is the correct number of days of data.</p>
<pre class="r"><code># Age distribution of cases in mainland China as of 2020-02-11 --------- 
# (Chinese CDC Weekly, The epidemiological characteristics of an outbreak...)

cases_tmax = c(416,549,3619,7600,8571,10008,8583,3918,1408)
prop_cases_tmax = cases_tmax / sum(cases_tmax)

# Age distribution of deaths in mainland China as of 2020-02-11 --------- 
# (Chinese CDC Weekly, The epidemiological characteristics of an outbreak...)

mort_tmax = c(0,1,7,18,38,130,309,312,208)
prop_mort_tmax = mort_tmax / sum(mort_tmax)</code></pre>
<p>This last bit of coded is the hard-coded values for the “Confirmed cases” and “Reported deaths” panels of Figure 1B.</p>
<p>Grab all of this data:</p>
<pre class="r"><code>chinese_age_dist &lt;- fig1b_data %&gt;%
  filter(var == &quot;Chinese population&quot;) %&gt;%
  pull(prop)
hubei_population &lt;- 59020000
incidence_cases_hubei &lt;- confirmed_cases %&gt;%
  filter(date &gt;= data_start_date) %&gt;%
  pull(confirmed_cases_hubei)
incidence_deaths_hubei &lt;- confirmed_cases %&gt;%
  filter(date &gt;= data_start_date) %&gt;%
  pull(reported_deaths)
chinese_cases_dist &lt;- fig1b_data %&gt;%
  filter(var == &quot;Confirmed cases&quot;) %&gt;%
  pull(prop)
chinese_deaths_dist &lt;- fig1b_data %&gt;%
  filter(var == &quot;Reported deaths&quot;) %&gt;%
  pull(prop)</code></pre>
<p>Now we can start commenting on some of these values:</p>
<pre class="r"><code># Format data and set priors
data_list_model10 = list(
  time_lag=100, # extra days after tmax
  K=9, # number of age groups
  age_dist=age_dist,
  pop_t = pop_t,
  t0=0, # start time
  t_data = t_data, # the day on which data begins (2)
  tmax =tmax, # maximum number of days (43)
  tmax2 = tmax, # same
  tswitch = tswitch, # the day with control measurse + traffic restrictions (24)
  S=S, # number of days tmax + time_lag (143)
  ts = 1:S, # vector of those days
  D = D, # number of days with data + 1 (42)
  incidence_cases = incidence_cases,
  incidence_deaths = incidence_deaths,
  agedistr_cases = cases_tmax,
  agedistr_deaths = mort_tmax,
  p_beta=1,
  p_eta=c(1,1),
  p_pi=c(1,999),
  p_incubation=5.6, # Incubation including WR (Linton)
  p_infectious=2.9, # Infectious period (Liu)
  p_psi=0.49, # Diamond princess
  p_epsilon=c(1,1),
  p_phi = 1/100,
  p_rho=c(1,1),
  p_xi=1,
  p_nu=1/5,
  G=60,
  p_gamma=gamma,
  inference=0,
  doprint=0
)</code></pre>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references hanging-indent">
<div id="ref-Riou2020">
<p>Riou, Julien, Anthony Hauser, Michel J Counotte, and Christian L Althaus. 2020. “Adjusted age-specific case fatality ratio during the COVID-19 epidemic in Hubei, China, January and February 2020.” <em>medRxiv Preprint</em>. <a href="https://doi.org/10.1101/2020.03.04.20031104">https://doi.org/10.1101/2020.03.04.20031104</a>.</p>
</div>
</div>
</div>
