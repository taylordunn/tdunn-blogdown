---
title: 'Ordinal regression in R: part 2'
author: Taylor Dunn
date: '2020-03-15'
slug: ordinal-regression-in-r-part-2
categories: []
tags:
  - tidyverse
  - rstats
  - regression
  - bayesian
bibliography: references.bib
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p>This is part 2 of learning ordinal regression in R.
Previously, we explored the frequentist framework with the <code>ordinal</code> package.
Here, we’ll use <a href="https://cran.r-project.org/web/packages/brms/index.html"><code>brms</code> package</a> to fit Bayesian mixed models via Stan.</p>
<p>Though I won’t be reproducing their examples, <span class="citation">Bürkner and Vuorre (2019)</span> give a great tutorial of using <code>brms</code> for ordinal regression models.
It also frames the cumulative model in the terms of a latent (not observable) continuous variable <span class="math inline">\(\tilde{y}\)</span>, which has been categorized into the observed ordinal variable <span class="math inline">\(y\)</span>.
I found this way of thinking very intuitive, and it helped make a lot of the concepts click.</p>
<p>This post also serves as practice in Bayesian inference, so I’ll be comparing the results here to those from part 1, and explore different choices of prior distributions.</p>
<div id="setup" class="section level1">
<h1>Setup</h1>
<p>Import all the packages, and the same <code>wine</code> data from <span class="citation">Randall (1989)</span> that we analyzed in part 1:</p>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## Warning: package &#39;tidyverse&#39; was built under R version 3.6.3</code></pre>
<pre><code>## Warning: package &#39;tibble&#39; was built under R version 3.6.3</code></pre>
<pre><code>## Warning: package &#39;purrr&#39; was built under R version 3.6.3</code></pre>
<pre><code>## Warning: package &#39;forcats&#39; was built under R version 3.6.3</code></pre>
<pre class="r"><code>library(gt)</code></pre>
<pre><code>## Warning: package &#39;gt&#39; was built under R version 3.6.3</code></pre>
<pre class="r"><code>library(broom)</code></pre>
<pre><code>## Warning: package &#39;broom&#39; was built under R version 3.6.3</code></pre>
<pre class="r"><code>library(patchwork)
library(here)
library(tidybayes)</code></pre>
<pre><code>## Warning: package &#39;tidybayes&#39; was built under R version 3.6.3</code></pre>
<pre class="r"><code># Set ggplot2 theme and defaults
theme_set(cowplot::theme_cowplot() + cowplot::background_grid(major = &quot;xy&quot;))
ggp &lt;- function(...) ggplot(...) +
  scale_color_brewer(palette = &quot;Set1&quot;) +
  scale_fill_brewer(palette = &quot;Set1&quot;)

library(ordinal)</code></pre>
<pre><code>## Warning: package &#39;ordinal&#39; was built under R version 3.6.3</code></pre>
<pre class="r"><code>data(wine)
wine &lt;- as_tibble(wine)
library(brms)
# Detect and set the number of cores for MCMC
options(mc.cores = parallel::detectCores())</code></pre>
</div>
<div id="bayesian-regression" class="section level1">
<h1>Bayesian regression</h1>
<p>We will be fitting these models of <code>wine</code> bitterness <code>rating</code>s:</p>
<p><span class="math display">\[
\begin{align}
\text{logit}(p(y_i \leq j)) &amp;= \theta_j - u( \text{judge}_i) \\
\text{logit}(p(y_i \leq j)) &amp;= \theta_j - \beta_1 \text{temp}_i - \beta_2 \text{contact}_i - u( \text{judge}_i) \\
\end{align}
\]</span>
where <span class="math inline">\(p(y_i \leq j)\)</span> is the probability of a <code>rating</code> less than or equal to <span class="math inline">\(j\)</span>, <span class="math inline">\(\theta_j\)</span> are the thresholds for the <span class="math inline">\(J-1 = 4\)</span> levels, <span class="math inline">\(u(\text{judge}_i)\)</span> are judge-specific random effects, and <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span> are fixed effect coefficients for <span class="math inline">\(\text{temp}_i\)</span> and <span class="math inline">\(\text{contact}_i\)</span>.
(See part 1 for more details).</p>
<pre class="r"><code>f_rating_null &lt;- rating ~ 1 + (1|judge)
f_rating_contact_temp &lt;- rating ~ 1 + contact + temp + (1|judge)</code></pre>
<div id="null-model" class="section level2">
<h2>Null model</h2>
<p>We will start with the “null” model, with just thresholds and random effects.
The default priors for this model are:</p>
<pre class="r"><code>get_prior(f_rating_null, data = wine, family = cumulative(&quot;logit&quot;))</code></pre>
<pre><code>##                 prior     class      coef group resp dpar nlpar bound
## 1 student_t(3, 0, 10) Intercept                                      
## 2                     Intercept         1                            
## 3                     Intercept         2                            
## 4                     Intercept         3                            
## 5                     Intercept         4                            
## 6 student_t(3, 0, 10)        sd                                      
## 7                            sd           judge                      
## 8                            sd Intercept judge</code></pre>
<p><span class="math display">\[
\begin{align}
\text{logit}(p(y_i \leq j)) &amp;= \theta_j - u( \text{judge}_i) \\
\theta_j &amp;\sim \text{Student-}t(3, 0, 10) \\
u(\text{judge}_i) &amp;\sim \text{Normal}(0, \sigma_u) \\
\sigma_u &amp;\sim \text{Student-} t(3, 0, 10)
\end{align}
\]</span></p>
<p>Fit the model:</p>
<pre class="r"><code>brm_rating_null &lt;-
  brm(
    f_rating_null,
    data = wine,
    family = cumulative(&quot;logit&quot;),
    sample_prior = TRUE,
    file = &quot;brm_rating_null&quot;
  )</code></pre>
<p>We can visualize the two priors (on thresholds/Intercepts, and on SD of judge effects) with <code>brms:prior_samples</code>:</p>
<pre class="r"><code>p1 &lt;-
  prior_samples(brm_rating_null) %&gt;%
  gather(term, value) %&gt;%
  mutate(samples = &quot;model prior samples&quot;) %&gt;%
  ggplot(aes(x = value, color = samples)) +
  geom_density(size = 1) +
  # We can get prior samples without fitting a model of course: just random
  #  sampling from the appropriate distribution
  geom_density(
    data = tibble(value = rstudent_t(n = 4000, df = 3, mu = 0, sigma = 10),
                  samples = &quot;student_t(3, 0, 10)&quot;, term = &quot;Intercept&quot;),
    size = 1
  ) +
  geom_density(
    data = tibble(value = abs(rstudent_t(n = 4000, df = 3, mu = 0, sigma = 10)),
                  samples = &quot;abs(student_t(3, 0, 10))&quot;, term = &quot;sd_judge&quot;),
    size = 1,
  ) +
  facet_wrap(~term, scales = &quot;free&quot;) +
  cowplot::theme_minimal_vgrid() +
  scale_color_manual(
    values = c(&quot;model prior samples&quot; = &quot;black&quot;,
               &quot;student_t(3, 0, 10)&quot; = &quot;#E41A1C&quot;,
               &quot;abs(student_t(3, 0, 10))&quot; = &quot;#377EB8&quot;)
  ) +
  theme(axis.text.y = element_blank(),
        axis.ticks.y = element_blank())
p1 +
  (p1 + coord_cartesian(xlim = c(-10, 20))) +
  plot_layout(ncol = 1, guides = &quot;collect&quot;)</code></pre>
<p><img src="/post/2020-03-15-ordinal-regression-in-r-part-2/index_files/figure-html/unnamed-chunk-4-1.png" width="768" /></p>
<p>Note that, since a standard deviation can’t be negative, <code>brms</code> automatically takes the absolute value of the default <code>student_t(3, 0, 10)</code> prior.</p>
<p>These are obviously very uninformative priors.
For instance, Intercepts (the thresholds <span class="math inline">\(\theta_j\)</span>) between -20 and +20 correspond to the following probabilities:</p>
<pre class="r"><code>tibble(theta = seq(-20, 20)) %&gt;%
  mutate(p = inv_logit_scaled(theta)) %&gt;%
  ggp(aes(x = theta, y = p)) +
  geom_line(size = 1)</code></pre>
<p><img src="/post/2020-03-15-ordinal-regression-in-r-part-2/index_files/figure-html/unnamed-chunk-5-1.png" width="384" /></p>
<p>So any prior values of, say, -10 are assigning essentially zero cumulative probability for a level <span class="math inline">\(\leq j\)</span>.</p>
<p>Now that we’ve thought about our (default) prior assumptions, investigate the chains:</p>
<pre class="r"><code>plot(brm_rating_null)</code></pre>
<p><img src="/post/2020-03-15-ordinal-regression-in-r-part-2/index_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>The Intercept trace plots look good to me.
There are some spikes in <code>sd_judge__Intercept</code>, but not enough to be concerning.</p>
<p>Print the model estimates:</p>
<pre class="r"><code>brm_rating_null</code></pre>
<pre><code>##  Family: cumulative 
##   Links: mu = logit; disc = identity 
## Formula: rating ~ 1 + (1 | judge) 
##    Data: wine (Number of observations: 72) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Group-Level Effects: 
## ~judge (Number of levels: 9) 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)     0.83      0.48     0.07     1.97 1.00     1139     1042
## 
## Population-Level Effects: 
##              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept[1]    -2.90      0.59    -4.15    -1.90 1.00     2064     2230
## Intercept[2]    -0.58      0.40    -1.39     0.20 1.00     2389     2617
## Intercept[3]     1.14      0.41     0.34     1.95 1.00     2347     2806
## Intercept[4]     2.51      0.52     1.53     3.61 1.00     3032     2792
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>The <code>Rhat</code> values are also a good sign of model convergence.
Another thing we can do is a posterior predictive check:</p>
<pre class="r"><code>pp_check(brm_rating_null)</code></pre>
<pre><code>## Using 10 posterior samples for ppc type &#39;dens_overlay&#39; by default.</code></pre>
<p><img src="/post/2020-03-15-ordinal-regression-in-r-part-2/index_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Compare our null Bayesian model estimates to the frequentist estimates:</p>
<pre class="r"><code># Can&#39;t figure out how to extract random effect SDs from a clmm model, use clmm2
clmm2_rating_null &lt;-
  clmm2(
    rating ~ 1, random = judge,
    data = wine, link = &quot;logistic&quot;, Hess = TRUE
  )
# Unfortunately, clmm2 doesn&#39;t have a broom::tidy() function
summary(clmm2_rating_null) %&gt;%
  coef() %&gt;%
  as_tibble() %&gt;%
  mutate(term = str_c(&quot;b_Intercept[&quot;, 1:4, &quot;]&quot;)) %&gt;%
  bind_rows(
    tibble(
      Estimate = as.numeric(clmm2_rating_null$stDev),
      term = &quot;sd_judge__Intercept&quot;
    )
  ) %&gt;%
  janitor::clean_names() %&gt;%
  left_join(
    tidy(brm_rating_null),
    by = &quot;term&quot;
  ) %&gt;%
  select(term, everything()) %&gt;%
  mutate(
    pr_z = scales::pvalue(pr_z),
    across(is.numeric, ~round(., 2))
  ) %&gt;%
  gt() %&gt;%
  tab_spanner(
    label = &quot;ordinal::clmm&quot;,
    columns = vars(estimate.x, std_error, z_value, pr_z)
  ) %&gt;%
  tab_spanner(
    label = &quot;brms::brm&quot;,
    columns = vars(estimate.y, std.error, lower, upper)
  ) %&gt;%
  fmt_missing(columns = everything(), missing_text = &quot;&quot;)</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#kdaqvacivm .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#kdaqvacivm .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kdaqvacivm .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#kdaqvacivm .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#kdaqvacivm .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kdaqvacivm .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kdaqvacivm .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#kdaqvacivm .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#kdaqvacivm .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#kdaqvacivm .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#kdaqvacivm .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#kdaqvacivm .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#kdaqvacivm .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#kdaqvacivm .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#kdaqvacivm .gt_from_md > :first-child {
  margin-top: 0;
}

#kdaqvacivm .gt_from_md > :last-child {
  margin-bottom: 0;
}

#kdaqvacivm .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#kdaqvacivm .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#kdaqvacivm .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kdaqvacivm .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#kdaqvacivm .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kdaqvacivm .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#kdaqvacivm .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kdaqvacivm .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kdaqvacivm .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#kdaqvacivm .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kdaqvacivm .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#kdaqvacivm .gt_left {
  text-align: left;
}

#kdaqvacivm .gt_center {
  text-align: center;
}

#kdaqvacivm .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#kdaqvacivm .gt_font_normal {
  font-weight: normal;
}

#kdaqvacivm .gt_font_bold {
  font-weight: bold;
}

#kdaqvacivm .gt_font_italic {
  font-style: italic;
}

#kdaqvacivm .gt_super {
  font-size: 65%;
}

#kdaqvacivm .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="kdaqvacivm" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_center gt_columns_bottom_border" rowspan="2" colspan="1">term</th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="4">
        <span class="gt_column_spanner">ordinal::clmm</span>
      </th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="4">
        <span class="gt_column_spanner">brms::brm</span>
      </th>
    </tr>
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">estimate.x</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">std_error</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">z_value</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">pr_z</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">estimate.y</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">std.error</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">lower</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1">upper</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">b_Intercept[1]</td>
      <td class="gt_row gt_right">-2.72</td>
      <td class="gt_row gt_right">0.52</td>
      <td class="gt_row gt_right">-5.25</td>
      <td class="gt_row gt_left">&lt;0.001</td>
      <td class="gt_row gt_right">-2.90</td>
      <td class="gt_row gt_right">0.59</td>
      <td class="gt_row gt_right">-3.94</td>
      <td class="gt_row gt_right">-2.02</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">b_Intercept[2]</td>
      <td class="gt_row gt_right">-0.54</td>
      <td class="gt_row gt_right">0.32</td>
      <td class="gt_row gt_right">-1.72</td>
      <td class="gt_row gt_left">0.085</td>
      <td class="gt_row gt_right">-0.58</td>
      <td class="gt_row gt_right">0.40</td>
      <td class="gt_row gt_right">-1.23</td>
      <td class="gt_row gt_right">0.07</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">b_Intercept[3]</td>
      <td class="gt_row gt_right">1.10</td>
      <td class="gt_row gt_right">0.34</td>
      <td class="gt_row gt_right">3.24</td>
      <td class="gt_row gt_left">0.001</td>
      <td class="gt_row gt_right">1.14</td>
      <td class="gt_row gt_right">0.41</td>
      <td class="gt_row gt_right">0.50</td>
      <td class="gt_row gt_right">1.81</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">b_Intercept[4]</td>
      <td class="gt_row gt_right">2.35</td>
      <td class="gt_row gt_right">0.46</td>
      <td class="gt_row gt_right">5.13</td>
      <td class="gt_row gt_left">&lt;0.001</td>
      <td class="gt_row gt_right">2.51</td>
      <td class="gt_row gt_right">0.52</td>
      <td class="gt_row gt_right">1.70</td>
      <td class="gt_row gt_right">3.42</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">sd_judge__Intercept</td>
      <td class="gt_row gt_right">0.57</td>
      <td class="gt_row gt_right"></td>
      <td class="gt_row gt_right"></td>
      <td class="gt_row gt_left"></td>
      <td class="gt_row gt_right">0.83</td>
      <td class="gt_row gt_right">0.48</td>
      <td class="gt_row gt_right">0.16</td>
      <td class="gt_row gt_right">1.69</td>
    </tr>
  </tbody>
  
  
</table></div>
<p>Frequentist estimates are pretty close to the Bayesian estimates with naive priors.</p>
<div id="choice-of-priors" class="section level3">
<h3>Choice of priors</h3>
<p>So what are reasonable priors for this data and model?
My go-to resource for this kind of thing is <a href="https://github.com/stan-dev/stan/wiki/Prior-Choice-Recommendations">this page from the stan wiki</a>, but under the “Prior for cutpoints in ordered logit or probit regression”, they have a couple suggestions like “uniform priors typically should be ok”, but also say “Need to flesh out this section with examples”, so not a lot of help there.</p>
<p>Let’s consider the following priors on the the thresholds:</p>
<p><span class="math display">\[
\begin{align}
\theta_j &amp;\sim \text{Student-}t(3, 0, 10) \\
\theta_j &amp;\sim \text{Student-}t(3, 0, 5) \\
\theta_j &amp;\sim \text{Student-}t(3, 0, 2) \\
\theta_j &amp;\sim \text{Normal}(0, 10) \\
\theta_j &amp;\sim \text{Normal}(0, 5) \\
\theta_j &amp;\sim \text{Normal}(0, 2)
\end{align}
\]</span></p>
<p>and simulate some corresponding cumulative probabilities:</p>
<pre class="r"><code>tibble(
  std_dev = c(10, 5, 2)
) %&gt;%
  mutate(
    prior = str_c(&quot;Normal(0, &quot;, std_dev, &quot;)&quot;),
    samples = map(std_dev, ~rnorm(2000, mean = 0, sd = .x))
  ) %&gt;%
  bind_rows(
    tibble(sigma = c(10, 5, 2)) %&gt;%
      mutate(prior = str_c(&quot;Student-t(3, 0, &quot;, sigma, &quot;)&quot;),
             samples = map(sigma, ~rstudent_t(2000, df = 3, mu = 0, sigma = .x)))
  ) %&gt;%
  unnest(samples) %&gt;%
  mutate(p = inv_logit_scaled(samples)) %&gt;%
  ggp(aes(x = p)) +
  geom_histogram(binwidth = 0.1) +
  facet_wrap(~prior) +
  scale_y_continuous(expand = c(0, 0))</code></pre>
<p><img src="/post/2020-03-15-ordinal-regression-in-r-part-2/index_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>To my eye, the <span class="math inline">\(\text{Normal}(0, 10)/\text{Student-}t(3, 0, 10)\)</span> and <span class="math inline">\(\text{Normal}(0, 5)/\text{Student-}t(3, 0, 5)\)</span> are not ideal because they place most of the samples at the extremes (cumulative probabilities of 0 and 100%).
<span class="math inline">\(\text{Normal}(0, 2)\)</span> and <span class="math inline">\(\text{Student-}t(3, 0, 2)\)</span> are much more equal in terms of sampling the “probability” space.</p>
<p>As for the scale parameter describing the variance in judge-specific random effects, I’ve seen the <a href="https://github.com/stan-dev/stan/wiki/Prior-Choice-Recommendations">half-Cauchy distribution recommended</a>:</p>
<pre class="r"><code>tibble(scale = c(1, 2.5, 5)) %&gt;%
  crossing(x = seq(0, 10, 0.1)) %&gt;%
  mutate(
    prior = str_c(&quot;Half-Cauchy(0, &quot;, scale, &quot;)&quot;),
    dens = dcauchy(x, location = 0, scale = scale)
  ) %&gt;%
  ggp(aes(x, y = dens)) +
  geom_line(aes(color = prior), size = 1) +
  theme(legend.position = c(0.6, 0.6),
        axis.text.y = element_blank())</code></pre>
<p><img src="/post/2020-03-15-ordinal-regression-in-r-part-2/index_files/figure-html/unnamed-chunk-11-1.png" width="480" /></p>
<p>This distribution is fairly conservative, with a long right tail that allows for large values.</p>
<p>Fit the null model using the the weakly informative <span class="math inline">\(\text{Normal}(0, 2)\)</span> prior on <span class="math inline">\(\theta_j\)</span> and
the <span class="math inline">\(\text{Half-Cauchy}(0, 2.5)\)</span> on <span class="math inline">\(\sigma_u\)</span>:</p>
<p><span class="math display">\[
\begin{align}
\text{logit}(p(y_i \leq j)) &amp;= \theta_j - u( \text{judge}_i) \\
\theta_j &amp;\sim \text{Normal}(0, 2) \\
u(\text{judge}_i) &amp;\sim \text{Normal}(0, \sigma_u) \\
\sigma_u &amp;\sim \text{Half-Cauchy}(0, 2.5)
\end{align}
\]</span></p>
<pre class="r"><code>prior_rating_null &lt;- c(
  prior(normal(0, 2.5), class = Intercept),
  prior(cauchy(0, 1), class = sd)
)
brm_rating_null_weak_prior &lt;-
  brm(
    f_rating_null,
    prior = prior_rating_null ,
    data = wine,
    family = cumulative(&quot;logit&quot;),
    file = &quot;brm_rating_null_weak_prior&quot;
  )
plot(brm_rating_null_weak_prior)</code></pre>
<p><img src="/post/2020-03-15-ordinal-regression-in-r-part-2/index_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>This doesn’t massively improve the model convergence (which, to be fair, was already good).
There are fewer large <code>sd_judge__Intercept</code> values in the posterior.
The model estimates changed only slightly:</p>
<pre class="r"><code>tidy(brm_rating_null) %&gt;%
  mutate(priors = &quot;default priors&quot;) %&gt;%
  bind_rows(
    tidy(brm_rating_null_weak_prior) %&gt;%
      mutate(priors = &quot;weak priors&quot;)
  ) %&gt;%
  filter(term != &quot;lp__&quot;, !str_starts(term, &quot;r_|prior_&quot;)) %&gt;%
  transmute(
    term,
    estimate_se = str_c(round(estimate, 2), &quot; (&quot;, round(std.error, 2), &quot;)&quot;),
    priors
  ) %&gt;%
  spread(priors, estimate_se) %&gt;%
  gt()</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#zwizrymizz .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#zwizrymizz .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zwizrymizz .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#zwizrymizz .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#zwizrymizz .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zwizrymizz .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zwizrymizz .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#zwizrymizz .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#zwizrymizz .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#zwizrymizz .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#zwizrymizz .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#zwizrymizz .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#zwizrymizz .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#zwizrymizz .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#zwizrymizz .gt_from_md > :first-child {
  margin-top: 0;
}

#zwizrymizz .gt_from_md > :last-child {
  margin-bottom: 0;
}

#zwizrymizz .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#zwizrymizz .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#zwizrymizz .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zwizrymizz .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#zwizrymizz .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zwizrymizz .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#zwizrymizz .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zwizrymizz .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zwizrymizz .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#zwizrymizz .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zwizrymizz .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#zwizrymizz .gt_left {
  text-align: left;
}

#zwizrymizz .gt_center {
  text-align: center;
}

#zwizrymizz .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#zwizrymizz .gt_font_normal {
  font-weight: normal;
}

#zwizrymizz .gt_font_bold {
  font-weight: bold;
}

#zwizrymizz .gt_font_italic {
  font-style: italic;
}

#zwizrymizz .gt_super {
  font-size: 65%;
}

#zwizrymizz .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="zwizrymizz" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">term</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">default priors</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">weak priors</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">b_Intercept[1]</td>
      <td class="gt_row gt_left">-2.9 (0.59)</td>
      <td class="gt_row gt_left">-2.78 (0.53)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">b_Intercept[2]</td>
      <td class="gt_row gt_left">-0.58 (0.4)</td>
      <td class="gt_row gt_left">-0.56 (0.34)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">b_Intercept[3]</td>
      <td class="gt_row gt_left">1.14 (0.41)</td>
      <td class="gt_row gt_left">1.09 (0.37)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">b_Intercept[4]</td>
      <td class="gt_row gt_left">2.51 (0.52)</td>
      <td class="gt_row gt_left">2.41 (0.48)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">sd_judge__Intercept</td>
      <td class="gt_row gt_left">0.83 (0.48)</td>
      <td class="gt_row gt_left">0.66 (0.38)</td>
    </tr>
  </tbody>
  
  
</table></div>
<p>So although the default priors really don’t describe the data or our expectations very well, they do just fine in estimating the model coefficients.</p>
</div>
</div>
<div id="fixed-effects" class="section level2">
<h2>Fixed effects</h2>
<p>We now add the “treatment” effects of <code>temp</code> and <code>contact</code>:</p>
<p><span class="math display">\[
\begin{align}
\text{logit}(p(y_i \leq j)) &amp;= \theta_j - \beta_1 \text{temp}_i - \beta_2 \text{contact}_i - u( \text{judge}_i) \\
\end{align}
\]</span></p>
<p>This introduces two new priors we can specify:</p>
<pre class="r"><code>get_prior(f_rating_contact_temp, data = wine, family = cumulative(&quot;logit&quot;))</code></pre>
<pre><code>##                  prior     class       coef group resp dpar nlpar bound
## 1                              b                                       
## 2                              b contactyes                            
## 3                              b   tempwarm                            
## 4  student_t(3, 0, 10) Intercept                                       
## 5                      Intercept          1                            
## 6                      Intercept          2                            
## 7                      Intercept          3                            
## 8                      Intercept          4                            
## 9  student_t(3, 0, 10)        sd                                       
## 10                            sd            judge                      
## 11                            sd  Intercept judge</code></pre>
<p>We know from part 1 that <code>contactyes</code> (<span class="math inline">\(\beta_1\)</span>) and <code>tempwarm</code> (<span class="math inline">\(\beta_2\)</span>) are associated with higher ratings, but we shouldn’t be biasing our priors by using the same data we are modeling.
Instead, use a weakly regularizing normal distributions centered at 0:</p>
<p><span class="math display">\[
\begin{align}
\text{logit}(p(y_i \leq j)) &amp;= \theta_j - \beta_1 \text{temp}_i - \beta_2 \text{contact}_i - u( \text{judge}_i) \\
\beta_1 &amp;\sim \text{Normal}(0, 5) \\
\beta_2 &amp;\sim \text{Normal}(0, 5) \\
\theta_j &amp;\sim \text{Normal}(0, 2) \\
u(\text{judge}_i) &amp;\sim \text{Normal}(0, \sigma_u) \\
\sigma_u &amp;\sim \text{Half-Cauchy}(0, 2.5)
\end{align}
\]</span></p>
<pre class="r"><code>prior_rating_contact_temp &lt;-
  c(prior_rating_null,
    prior(normal(0, 5), class = b))

brm_rating_contact_temp &lt;-
  brm(
    f_rating_contact_temp,
    prior = prior_rating_contact_temp,
    data = wine,
    family = cumulative(&quot;logit&quot;),
    file = &quot;brm_rating_contact_temp_weak_prior&quot;
  )
# Also fit using the default priors
brm_rating_contact_temp_default_prior &lt;-
  brm(
    f_rating_contact_temp,
    data = wine,
    family = cumulative(&quot;logit&quot;),
    sample_prior = TRUE,
    file = &quot;brm_rating_contact_temp_default_prior&quot;
  )
brm_rating_contact_temp</code></pre>
<pre><code>##  Family: cumulative 
##   Links: mu = logit; disc = identity 
## Formula: rating ~ 1 + contact + temp + (1 | judge) 
##    Data: wine (Number of observations: 72) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Group-Level Effects: 
## ~judge (Number of levels: 9) 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)     1.20      0.45     0.49     2.22 1.00     1254     1034
## 
## Population-Level Effects: 
##              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept[1]    -1.59      0.66    -2.89    -0.37 1.00     2398     2673
## Intercept[2]     1.44      0.59     0.32     2.65 1.00     2676     2956
## Intercept[3]     4.05      0.76     2.66     5.68 1.00     2489     2594
## Intercept[4]     5.89      0.89     4.23     7.71 1.00     2539     3283
## contactyes       1.76      0.49     0.81     2.73 1.00     3403     3017
## tempwarm         2.95      0.55     1.92     4.05 1.00     2933     3337
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Compare these estimates to those from <code>clmm</code> and with default priors:</p>
<pre class="r"><code>clmm2_rating_contact_temp &lt;-
  clmm2(
    rating ~ contact + temp, random = judge,
    data = wine, link = &quot;logistic&quot;, Hess = TRUE
  )

tidy(brm_rating_contact_temp) %&gt;%
  mutate(model = &quot;brm weak priors&quot;) %&gt;%
  bind_rows(
    tidy(brm_rating_contact_temp_default_prior) %&gt;%
      mutate(model = &quot;brm default priors&quot;)
  ) %&gt;%
  filter(!str_detect(term, &quot;r_judge|lp__|prior&quot;)) %&gt;%
  transmute(
    term, model,
    estimate_se = str_c(round(estimate, 2), &quot; (&quot;, round(std.error, 2), &quot;)&quot;)
  ) %&gt;%
  bind_rows(
    summary(clmm2_rating_contact_temp) %&gt;%
      coef() %&gt;%
      as_tibble() %&gt;%
      mutate(term = c(str_c(&quot;b_Intercept[&quot;, 1:4, &quot;]&quot;),
                      &quot;b_contactyes&quot;, &quot;b_tempwarm&quot;)) %&gt;%
      bind_rows(
        tibble(
          Estimate = as.numeric(clmm2_rating_contact_temp$stDev),
          term = &quot;sd_judge__Intercept&quot;
        )
      ) %&gt;%
      janitor::clean_names() %&gt;%
      transmute(
        model = &quot;clmm&quot;, term,
        estimate_se = ifelse(
          !is.na(std_error),
          str_c(round(estimate, 2), &quot; (&quot;, round(std_error, 2), &quot;)&quot;),
          round(estimate, 2)
        )
      )
  ) %&gt;%
  spread(model, estimate_se) %&gt;%
  gt()</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#lkknmtevhc .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#lkknmtevhc .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lkknmtevhc .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#lkknmtevhc .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#lkknmtevhc .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lkknmtevhc .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lkknmtevhc .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#lkknmtevhc .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#lkknmtevhc .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#lkknmtevhc .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#lkknmtevhc .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#lkknmtevhc .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#lkknmtevhc .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#lkknmtevhc .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#lkknmtevhc .gt_from_md > :first-child {
  margin-top: 0;
}

#lkknmtevhc .gt_from_md > :last-child {
  margin-bottom: 0;
}

#lkknmtevhc .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#lkknmtevhc .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#lkknmtevhc .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lkknmtevhc .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#lkknmtevhc .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lkknmtevhc .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#lkknmtevhc .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lkknmtevhc .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lkknmtevhc .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#lkknmtevhc .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lkknmtevhc .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#lkknmtevhc .gt_left {
  text-align: left;
}

#lkknmtevhc .gt_center {
  text-align: center;
}

#lkknmtevhc .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#lkknmtevhc .gt_font_normal {
  font-weight: normal;
}

#lkknmtevhc .gt_font_bold {
  font-weight: bold;
}

#lkknmtevhc .gt_font_italic {
  font-style: italic;
}

#lkknmtevhc .gt_super {
  font-size: 65%;
}

#lkknmtevhc .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="lkknmtevhc" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">term</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">brm default priors</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">brm weak priors</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">clmm</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">b_contactyes</td>
      <td class="gt_row gt_left">1.98 (0.53)</td>
      <td class="gt_row gt_left">1.76 (0.49)</td>
      <td class="gt_row gt_left">1.83 (0.51)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">b_Intercept[1]</td>
      <td class="gt_row gt_left">-1.76 (0.83)</td>
      <td class="gt_row gt_left">-1.59 (0.66)</td>
      <td class="gt_row gt_left">-1.62 (0.68)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">b_Intercept[2]</td>
      <td class="gt_row gt_left">1.65 (0.76)</td>
      <td class="gt_row gt_left">1.44 (0.59)</td>
      <td class="gt_row gt_left">1.51 (0.6)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">b_Intercept[3]</td>
      <td class="gt_row gt_left">4.57 (0.98)</td>
      <td class="gt_row gt_left">4.05 (0.76)</td>
      <td class="gt_row gt_left">4.23 (0.81)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">b_Intercept[4]</td>
      <td class="gt_row gt_left">6.6 (1.15)</td>
      <td class="gt_row gt_left">5.89 (0.89)</td>
      <td class="gt_row gt_left">6.09 (0.97)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">b_tempwarm</td>
      <td class="gt_row gt_left">3.31 (0.64)</td>
      <td class="gt_row gt_left">2.95 (0.55)</td>
      <td class="gt_row gt_left">3.06 (0.6)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">sd_judge__Intercept</td>
      <td class="gt_row gt_left">1.62 (0.65)</td>
      <td class="gt_row gt_left">1.2 (0.45)</td>
      <td class="gt_row gt_left">1.13</td>
    </tr>
  </tbody>
  
  
</table></div>
</div>
</div>
<div id="aside-adjacent-category-models" class="section level1">
<h1>Aside: adjacent-category models</h1>
<p>Here are what <span class="citation">Bürkner and Vuorre (2019)</span> had to say about the adjacent-category class of ordinal models.</p>
<ul>
<li>Predict the decision between two adjacent categories <span class="math inline">\(k\)</span> and <span class="math inline">\(k+1\)</span></li>
<li>Latent variables <span class="math inline">\(\tilde{Y}_k\)</span> with thresholds <span class="math inline">\(\tau_k\)</span> and cumulative distribution function <span class="math inline">\(F\)</span></li>
<li>If <span class="math inline">\(\tilde{Y}_k &lt; \tau_k\)</span>, we choose category <span class="math inline">\(k\)</span>; <span class="math inline">\(k+1\)</span> otherwise</li>
<li>It is difficult to think of a natural process leading to them; chosen for its mathematical convenience rather than quality of interpretation</li>
</ul>
<p>Mathematically:</p>
<p><span class="math display">\[
\text{Pr}(Y = k | Y \in \{k, k+1\}) = F(\tau_k)
\]</span></p>
<p>Suppose the latent variable <span class="math inline">\(\tilde{Y}_2\)</span> is standard normally distributed with distribution function <span class="math inline">\(\Phi\)</span>, and <span class="math inline">\(\tau_2\)</span> = 1.
Then the probability of choosing <span class="math inline">\(Y\)</span> = 2 over <span class="math inline">\(Y\)</span> = 3 would be written as:</p>
<p><span class="math display">\[
\text{Pr}(Y = 2 | Y \in \{2, 3\}) = \Phi(\tau_2) = \Phi(1) = 0.84
\]</span>
Try fitting the null wine rating model with the <code>acat</code> family in <code>brms</code>:</p>
<pre class="r"><code>brm_rating_contact_temp_default_prior_acat &lt;-
  brm(
    f_rating_contact_temp,
    family = acat(link = &quot;logit&quot;),
    data = wine,
    file = &quot;brm_rating_contact_temp_default_prior_acat&quot;
  )</code></pre>
<p>How do these estimates compare to the cumulative model?</p>
<pre class="r"><code>tidy(brm_rating_contact_temp_default_prior) %&gt;%
  mutate(model = &quot;cumulative&quot;) %&gt;%
  bind_rows(
    tidy(brm_rating_contact_temp_default_prior_acat) %&gt;%
      mutate(model = &quot;adjacent-category&quot;)
  ) %&gt;%
  filter(!str_detect(term, &quot;r_judge|lp__|prior&quot;)) %&gt;%
  transmute(
    term, model,
    estimate_se = str_c(round(estimate, 2), &quot; (&quot;, round(std.error, 2), &quot;)&quot;)
  ) %&gt;%
  spread(model, estimate_se) %&gt;%
  gt()</code></pre>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#uupsgcsuca .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#uupsgcsuca .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#uupsgcsuca .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#uupsgcsuca .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#uupsgcsuca .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uupsgcsuca .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#uupsgcsuca .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#uupsgcsuca .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#uupsgcsuca .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#uupsgcsuca .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#uupsgcsuca .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#uupsgcsuca .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#uupsgcsuca .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#uupsgcsuca .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#uupsgcsuca .gt_from_md > :first-child {
  margin-top: 0;
}

#uupsgcsuca .gt_from_md > :last-child {
  margin-bottom: 0;
}

#uupsgcsuca .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#uupsgcsuca .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#uupsgcsuca .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#uupsgcsuca .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#uupsgcsuca .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#uupsgcsuca .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#uupsgcsuca .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uupsgcsuca .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#uupsgcsuca .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#uupsgcsuca .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#uupsgcsuca .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#uupsgcsuca .gt_left {
  text-align: left;
}

#uupsgcsuca .gt_center {
  text-align: center;
}

#uupsgcsuca .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#uupsgcsuca .gt_font_normal {
  font-weight: normal;
}

#uupsgcsuca .gt_font_bold {
  font-weight: bold;
}

#uupsgcsuca .gt_font_italic {
  font-style: italic;
}

#uupsgcsuca .gt_super {
  font-size: 65%;
}

#uupsgcsuca .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="uupsgcsuca" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">term</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">adjacent-category</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">cumulative</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">b_contactyes</td>
      <td class="gt_row gt_left">1.48 (0.43)</td>
      <td class="gt_row gt_left">1.98 (0.53)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">b_Intercept[1]</td>
      <td class="gt_row gt_left">-1.42 (0.74)</td>
      <td class="gt_row gt_left">-1.76 (0.83)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">b_Intercept[2]</td>
      <td class="gt_row gt_left">1.32 (0.63)</td>
      <td class="gt_row gt_left">1.65 (0.76)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">b_Intercept[3]</td>
      <td class="gt_row gt_left">3.72 (0.88)</td>
      <td class="gt_row gt_left">4.57 (0.98)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">b_Intercept[4]</td>
      <td class="gt_row gt_left">4.61 (1.15)</td>
      <td class="gt_row gt_left">6.6 (1.15)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">b_tempwarm</td>
      <td class="gt_row gt_left">2.58 (0.58)</td>
      <td class="gt_row gt_left">3.31 (0.64)</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">sd_judge__Intercept</td>
      <td class="gt_row gt_left">1.23 (0.52)</td>
      <td class="gt_row gt_left">1.62 (0.65)</td>
    </tr>
  </tbody>
  
  
</table></div>
<p><code>brms</code> has a convenience function <code>marginal_effects</code> for quickly plotting estimates.
For example, the effect of <code>category</code>:</p>
<pre class="r"><code>me_rating_contact_temp_default_prior_acat &lt;-
  marginal_effects(brm_rating_contact_temp_default_prior_acat, categorical = T,
                   re_formula = NA, ask = F)

me_rating_contact_temp_default_prior &lt;-
  marginal_effects(brm_rating_contact_temp_default_prior, categorical = T,
                   re_formula = NA, ask = F)

me_rating_contact_temp_default_prior_acat$`contact:cats__` %&gt;%
  mutate(model = &quot;adjacent-category&quot;) %&gt;%
  bind_rows(
    me_rating_contact_temp_default_prior$`contact:cats__` %&gt;%
      mutate(model = &quot;cumulative&quot;)
  ) %&gt;%
  ggplot(aes(x = contact, y = estimate__, color = effect2__)) +
  geom_point(position = position_dodge(1), size = 3) +
  geom_linerange(aes(ymin = lower__, ymax = upper__),
                 position = position_dodge(1), size = 1) +
  facet_wrap(~model) +
  scale_color_viridis_d() +
  labs(y = &quot;Estimated probabilities&quot;, color = &quot;rating&quot;)</code></pre>
<p><img src="/post/2020-03-15-ordinal-regression-in-r-part-2/index_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>The model classes are essentially the same.</p>
</div>
<div id="category-specific-effects" class="section level1">
<h1>Category-specific effects</h1>
<p>In all of the models specified so far, all fixed effects were presumed to affect all response categories equally.
For example, the effect of <code>temp</code> = warm had a mean effect of <span class="math inline">\(\beta_1\)</span> =
2.95 on the thresholds <span class="math inline">\(\theta_j\)</span>, for all <span class="math inline">\(j = 1, 2, 3, 4\)</span>.</p>
<p>This may not be an appropriate assumption.
For example, <code>temp</code> warm might have little relation to the highest <code>rating</code>, but it may strongly predict <code>rating</code>s of 3 relative to 1 or 2.</p>
<p>If this is a possibility, then we can model the predictor as having a <em>category-sepcific</em> effect by estimating <span class="math inline">\(K-1\)</span> coefficients for it.
The reason we’ve introduced the adjacent-category model is that it is unproblematic to incorporate these effects (sequential models work as well).
Cumulative models, however, can lead to negative probabilities, and so should be avoided when using category-specific effects.</p>
<p>Fit the adjacent-category model with category-specific effects on <code>temp</code>:</p>
<p><span class="math display">\[
\begin{align}
\text{logit}(p(y_i \leq j)) &amp;= \theta_j - \beta_{1j} \text{temp}_i - \beta_2 \text{contact}_i - u( \text{judge}_i) \\
\text{logit}(p(y_i \leq j)) &amp;= \theta_j - \beta_{1j} \text{temp}_i - u( \text{judge}_i) \\
\end{align}
\]</span></p>
<pre class="r"><code>f_rating_cs_temp &lt;- rating ~ 1 + cs(temp) + (1|judge)
# Note that category-specific priors aren&#39;t available
#get_prior(f_rating_cs_temp, data = wine, family = acat(link = &quot;logit&quot;))

brm_rating_cs_temp_default_prior_acat &lt;-
  brm(
    f_rating_cs_temp,
    family = acat(link = &quot;logit&quot;),
    data = wine,
    file = &quot;brm_rating_cs_temp_default_prior_acat&quot;
  )</code></pre>
<p>There were many divergent transitions.
Investigate the trace plots:</p>
<pre class="r"><code>plot(brm_rating_cs_temp_default_prior_acat)</code></pre>
<p><img src="/post/2020-03-15-ordinal-regression-in-r-part-2/index_files/figure-html/unnamed-chunk-22-1.png" width="672" /><img src="/post/2020-03-15-ordinal-regression-in-r-part-2/index_files/figure-html/unnamed-chunk-22-2.png" width="672" /></p>
<p>Most of the divergence is coming from estimating the lowest and highest coefficients <span class="math inline">\(\beta_{11}\)</span> and <span class="math inline">\(\beta_{14}\)</span>.
We will try some regularizing priors and increasing the <code>adapt_delta</code> argument:</p>
<pre class="r"><code>brm_rating_cs_temp_weak_prior_acat &lt;-
  brm(
    f_rating_cs_temp,
    prior = prior_rating_contact_temp,
    family = acat(link = &quot;logit&quot;),
    data = wine,
    file = &quot;brm_rating_cs_temp_weak_prior_acat&quot;,
    control = list(adapt_delta = 0.9)
  )
plot(brm_rating_cs_temp_weak_prior_acat)</code></pre>
<p><img src="/post/2020-03-15-ordinal-regression-in-r-part-2/index_files/figure-html/unnamed-chunk-23-1.png" width="672" /><img src="/post/2020-03-15-ordinal-regression-in-r-part-2/index_files/figure-html/unnamed-chunk-23-2.png" width="672" /></p>
<p>This makes a huge difference.
Compare to a model without category-specific effects:</p>
<pre class="r"><code>me_rating_cs_temp_weak_prior_acat &lt;-
  marginal_effects(brm_rating_cs_temp_weak_prior_acat, categorical = T,
                   re_formula = NA, ask = F)
brm_rating_temp_weak_prior_acat &lt;-
  brm(
    rating ~ 1 + temp + (1|judge),
    prior = prior_rating_contact_temp,
    family = acat(link = &quot;logit&quot;),
    data = wine,
    file = &quot;brm_rating_temp_weak_prior_acat&quot;
  )
me_rating_temp_weak_prior_acat &lt;-
  marginal_effects(brm_rating_temp_weak_prior_acat, categorical = T,
                   re_formula = NA, ask = F)

me_rating_temp_weak_prior_acat$`temp:cats__` %&gt;%
  mutate(model = &quot;constant effects&quot;) %&gt;%
  bind_rows(
    me_rating_cs_temp_weak_prior_acat$`temp:cats__` %&gt;%
      mutate(model = &quot;category-specific effects&quot;)
  ) %&gt;%
  ggplot(aes(x = temp, y = estimate__, color = effect2__)) +
  geom_point(position = position_dodge(1), size = 3) +
  geom_linerange(aes(ymin = lower__, ymax = upper__),
                 position = position_dodge(1), size = 1) +
  facet_wrap(~model) +
  scale_color_viridis_d() +
  labs(y = &quot;Estimated probabilities&quot;, color = &quot;rating&quot;)</code></pre>
<p><img src="/post/2020-03-15-ordinal-regression-in-r-part-2/index_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>Or, put the probabilities for each model side-by-side, along with the empirical probabilities:</p>
<pre class="r"><code>me_rating_temp_weak_prior_acat$`temp:cats__` %&gt;%
  mutate(model = &quot;constant effects&quot;) %&gt;%
  bind_rows(
    me_rating_cs_temp_weak_prior_acat$`temp:cats__` %&gt;%
      mutate(model = &quot;category-specific effects&quot;)
  ) %&gt;%
  ggp(aes(x = effect2__, y = estimate__, color = model)) +
  geom_point(position = position_dodge(0.5), size = 3) +
  geom_linerange(aes(ymin = lower__, ymax = upper__),
                 position = position_dodge(0.5), size = 1) +
  geom_point(
    data = wine %&gt;%
      group_by(temp, rating) %&gt;%
      tally() %&gt;%
      group_by(temp) %&gt;%
      mutate(p = n / sum(n), model = &quot;empirical&quot;),
    aes(x = rating, y = p, color = model), size = 3
  ) +
  facet_wrap(~temp, ncol = 1) +
  labs(y = &quot;Estimated probabilities&quot;, color = &quot;model&quot;)</code></pre>
<p><img src="/post/2020-03-15-ordinal-regression-in-r-part-2/index_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>We shouldn’t be surprised the the category-specific model is better – it has 4 more parameters to work with – but we can compare them using leave-one-out cross-validation to determine how much better:</p>
<pre class="r"><code>brm_rating_temp_weak_prior_acat &lt;-
  add_criterion(brm_rating_temp_weak_prior_acat, &quot;waic&quot;)
brm_rating_cs_temp_weak_prior_acat &lt;-
  add_criterion(brm_rating_cs_temp_weak_prior_acat, &quot;waic&quot;)
loo_compare(
  brm_rating_temp_weak_prior_acat,
  brm_rating_cs_temp_weak_prior_acat,
  criterion = &quot;waic&quot;
)</code></pre>
<pre><code>##                                    elpd_diff se_diff
## brm_rating_temp_weak_prior_acat     0.0       0.0   
## brm_rating_cs_temp_weak_prior_acat -1.0       0.7</code></pre>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references hanging-indent">
<div id="ref-Burkner2019">
<p>Bürkner, Paul-Christian, and Matti Vuorre. 2019. “Ordinal Regression Models in Psychology: A Tutorial.” <em>Advances in Methods and Practices in Psychological Science</em> 2 (1): 77–101. <a href="https://doi.org/10.1177/2515245918823199">https://doi.org/10.1177/2515245918823199</a>.</p>
</div>
<div id="ref-Randall1989">
<p>Randall, J. H. 1989. “The Analysis of Sensory Data by Generalized Linear Model.” <em>Biometrical Journal</em> 31 (7): 781–93. <a href="https://doi.org/10.1002/bimj.4710310703">https://doi.org/10.1002/bimj.4710310703</a>.</p>
</div>
</div>
</div>
